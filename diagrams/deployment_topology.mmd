%% TEMS Deployment Topology
%% Generated by AI Architect Agent - October 16, 2025
%% Shows bench/site architecture with optional external services

graph TB
    subgraph "Production Environment"
        subgraph "Bench Instance"
            A1[Nginx<br/>Web Server<br/>Port 80/443]
            A2[Gunicorn Workers<br/>WSGI App<br/>8 workers]
            A3[SocketIO Server<br/>Real-time Events<br/>Port 9000]
            A4[Redis Queue<br/>Background Jobs]
            A5[Redis Cache<br/>Session Store]
            A6[Scheduler<br/>Cron Jobs]
        end
        
        subgraph "Site: production.localhost"
            B1[Apps:<br/>frappe, erpnext, tems]
            B2[Site Config<br/>db_name, redis_cache]
            B3[Private Files<br/>/sites/production/private]
            B4[Public Files<br/>/sites/production/public]
        end
        
        C1[(MariaDB<br/>Database Server<br/>Port 3306)]
        
        D1[File Storage<br/>S3 or Local FS]
    end
    
    subgraph "External Services (Optional)"
        E1[IoT Gateway<br/>MQTT Broker<br/>Sensor Data]
        E2[OpenAI API<br/>GPT-4/Embeddings]
        E3[Azure ML<br/>Custom Models]
        E4[SMS Gateway<br/>Africa's Talking]
        E5[Payment API<br/>M-Pesa/MTN]
        E6[WhatsApp Business<br/>API]
    end
    
    subgraph "Client Devices"
        F1[Desktop Browser<br/>Desk UI]
        F2[Mobile Browser<br/>Driver PWA]
        F3[IoT Sensors<br/>TPMS/GPS]
    end
    
    %% Client to Bench
    F1 -->|HTTPS| A1
    F2 -->|HTTPS| A1
    F3 -->|HTTPS/MQTT| E1
    
    %% Nginx routing
    A1 -->|/api| A2
    A1 -->|/assets| A2
    A1 -->|/socket.io| A3
    
    %% Gunicorn to services
    A2 --> B1
    A2 --> C1
    A2 --> A4
    A2 --> A5
    A3 --> A5
    A6 --> A4
    
    %% Site components
    B1 --> B2
    B1 --> C1
    B1 --> D1
    
    %% External integrations
    A2 -->|REST API| E1
    A2 -->|REST API| E2
    A2 -->|REST API| E3
    A2 -->|REST API| E4
    A2 -->|REST API| E5
    A2 -->|REST API| E6
    
    %% Styling
    classDef bench fill:#4A90E2,stroke:#2E5C8A,color:#fff
    classDef site fill:#7ED321,stroke:#5A9C18,color:#000
    classDef database fill:#F5A623,stroke:#C77D0A,color:#000
    classDef external fill:#BD10E0,stroke:#8A0BA8,color:#fff
    classDef client fill:#50E3C2,stroke:#2FA88F,color:#000
    
    class A1,A2,A3,A4,A5,A6 bench
    class B1,B2,B3,B4 site
    class C1,D1 database
    class E1,E2,E3,E4,E5,E6 external
    class F1,F2,F3 client
