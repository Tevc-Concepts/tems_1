{"version":3,"file":"trip-FwRjcpOd.js","sources":["../../../../../../frontend/driver-pwa/src/stores/trip.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref, computed } from 'vue'\nimport { frappeClient } from '@shared'\n\nexport const useTripStore = defineStore('trip', () => {\n  const trips = ref([])\n  const activeTrip = ref(null)\n  const loading = ref(false)\n  const error = ref(null)\n\n  const upcomingTrips = computed(() => \n    trips.value.filter(t => new Date(t.start_time) > new Date())\n  )\n  \n  const inProgressTrips = computed(() => \n    trips.value.filter(t => t.status === 'Active')\n  )\n\n  async function fetchDashboard() {\n    loading.value = true\n    error.value = null\n    \n    try {\n      const data = await frappeClient.call('tems.api.pwa.driver.get_driver_dashboard')\n      \n      trips.value = [\n        ...data.journey_plans.map(jp => ({ ...jp, type: 'journey' })),\n        ...data.operation_plans.map(op => ({ ...op, type: 'operation' }))\n      ]\n      \n      return data\n    } catch (err) {\n      error.value = err.message\n      throw err\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function fetchTripDetails(tripId) {\n    loading.value = true\n    \n    try {\n      const data = await frappeClient.call('tems.api.pwa.driver.get_journey_details', {\n        journey_plan_name: tripId\n      })\n      \n      return data\n    } catch (err) {\n      error.value = err.message\n      throw err\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function startTrip(tripId, odometerReading, locationData) {\n    try {\n      const result = await frappeClient.call('tems.api.pwa.driver.start_trip', {\n        journey_plan_name: tripId,\n        odometer_reading: odometerReading,\n        location_data: locationData\n      })\n      \n      activeTrip.value = tripId\n      await fetchDashboard()\n      \n      return result\n    } catch (err) {\n      error.value = err.message\n      throw err\n    }\n  }\n\n  async function completeTrip(tripId, odometerReading, locationData, notes) {\n    try {\n      const result = await frappeClient.call('tems.api.pwa.driver.complete_trip', {\n        journey_plan_name: tripId,\n        odometer_reading: odometerReading,\n        location_data: locationData,\n        notes: notes\n      })\n      \n      activeTrip.value = null\n      await fetchDashboard()\n      \n      return result\n    } catch (err) {\n      error.value = err.message\n      throw err\n    }\n  }\n\n  return {\n    trips,\n    activeTrip,\n    loading,\n    error,\n    upcomingTrips,\n    inProgressTrips,\n    fetchDashboard,\n    fetchTripDetails,\n    startTrip,\n    completeTrip\n  }\n})"],"names":["useTripStore","defineStore","trips","ref","activeTrip","loading","error","upcomingTrips","computed","t","inProgressTrips","fetchDashboard","data","frappeClient","jp","op","err","fetchTripDetails","tripId","startTrip","odometerReading","locationData","result","completeTrip","notes"],"mappings":"mGAIY,MAACA,EAAeC,EAAY,OAAQ,IAAM,CACpD,MAAMC,EAAQC,EAAI,CAAA,CAAE,EACdC,EAAaD,EAAI,IAAI,EACrBE,EAAUF,EAAI,EAAK,EACnBG,EAAQH,EAAI,IAAI,EAEhBI,EAAgBC,EAAS,IAC7BN,EAAM,MAAM,OAAOO,GAAK,IAAI,KAAKA,EAAE,UAAU,EAAI,IAAI,IAAM,CAC/D,EAEQC,EAAkBF,EAAS,IAC/BN,EAAM,MAAM,OAAOO,GAAKA,EAAE,SAAW,QAAQ,CACjD,EAEE,eAAeE,GAAiB,CAC9BN,EAAQ,MAAQ,GAChBC,EAAM,MAAQ,KAEd,GAAI,CACF,MAAMM,EAAO,MAAMC,EAAa,KAAK,0CAA0C,EAE/E,OAAAX,EAAM,MAAQ,CACZ,GAAGU,EAAK,cAAc,IAAIE,IAAO,CAAE,GAAGA,EAAI,KAAM,SAAS,EAAG,EAC5D,GAAGF,EAAK,gBAAgB,IAAIG,IAAO,CAAE,GAAGA,EAAI,KAAM,aAAc,CACxE,EAEaH,CACT,OAASI,EAAK,CACZ,MAAAV,EAAM,MAAQU,EAAI,QACZA,CACR,QAAC,CACCX,EAAQ,MAAQ,EAClB,CACF,CAEA,eAAeY,EAAiBC,EAAQ,CACtCb,EAAQ,MAAQ,GAEhB,GAAI,CAKF,OAJa,MAAMQ,EAAa,KAAK,0CAA2C,CAC9E,kBAAmBK,CAC3B,CAAO,CAGH,OAASF,EAAK,CACZ,MAAAV,EAAM,MAAQU,EAAI,QACZA,CACR,QAAC,CACCX,EAAQ,MAAQ,EAClB,CACF,CAEA,eAAec,EAAUD,EAAQE,EAAiBC,EAAc,CAC9D,GAAI,CACF,MAAMC,EAAS,MAAMT,EAAa,KAAK,iCAAkC,CACvE,kBAAmBK,EACnB,iBAAkBE,EAClB,cAAeC,CACvB,CAAO,EAED,OAAAjB,EAAW,MAAQc,EACnB,MAAMP,EAAc,EAEbW,CACT,OAASN,EAAK,CACZ,MAAAV,EAAM,MAAQU,EAAI,QACZA,CACR,CACF,CAEA,eAAeO,EAAaL,EAAQE,EAAiBC,EAAcG,EAAO,CACxE,GAAI,CACF,MAAMF,EAAS,MAAMT,EAAa,KAAK,oCAAqC,CAC1E,kBAAmBK,EACnB,iBAAkBE,EAClB,cAAeC,EACf,MAAOG,CACf,CAAO,EAED,OAAApB,EAAW,MAAQ,KACnB,MAAMO,EAAc,EAEbW,CACT,OAASN,EAAK,CACZ,MAAAV,EAAM,MAAQU,EAAI,QACZA,CACR,CACF,CAEA,MAAO,CACL,MAAAd,EACA,WAAAE,EACA,QAAAC,EACA,MAAAC,EACA,cAAAC,EACA,gBAAAG,EACA,eAAAC,EACA,iBAAAM,EACA,UAAAE,EACA,aAAAI,CACJ,CACA,CAAC"}