import{c as k,a as n,k as l,b as t,F as B,i as L,n as D,d as g,t as i,f as a,l as F,e as s,r as x,q as Y,o as Z,g as tt,w as et,j as st,s as ot,v as at}from"./index-PcK2SAYs.js";import it from"./AppLayout-CBjlc8mU.js";import{_ as rt}from"./LoadingSpinner-xLVHgiLr.js";import{_ as S}from"./StatusBadge-Cp8b1Ujq.js";import{M as I}from"./map-pin-jftitRPm.js";import{f as P}from"./format-BFuVVRWF.js";import{p as E}from"./parseISO-9qduH5JA.js";import{u as lt}from"./trip-BsvOeZik.js";import{u as nt}from"./vehicle-B1jYwrAQ.js";import{c as z}from"./createLucideIcon-BA_zicjl.js";import{R as ct}from"./refresh-cw-hDmae7zB.js";import{C as dt}from"./chevron-right-BZqzenys.js";import{T as V}from"./truck-CIvaZl73.js";import{U as ut,C as pt}from"./user-duRkX_VX.js";import{F as mt}from"./fuel-CrYuq5tK.js";import{T as vt}from"./triangle-alert-FxvP7yeT.js";import{N as ht}from"./navigation-BF03CYMh.js";import{F as xt}from"./file-text-CCvhKxET.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./log-out-C3CLS_jr.js";import"./useGeolocation-CaOISwgq.js";import"./incident-D1Lz0-dy.js";import"./Modal-BTtRlE28.js";import"./x-BbFY30U9.js";import"./Toast-mYUahUM_.js";import"./info-DqSwZgxb.js";import"./circle-x-DQl-CdHB.js";import"./circle-alert-DgqhRVXg.js";import"./en-US-DL7QEam1.js";/**
 * @license lucide-vue-next v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=z("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=z("route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),_t={class:"bg-white rounded-xl shadow-card p-4"},yt={class:"relative"},wt={class:"flex items-center justify-between"},bt={class:"font-medium text-gray-800"},kt={class:"text-xs text-gray-500"},Tt={key:0,class:"text-sm text-gray-600 mt-1"},Ct={key:1,class:"text-xs text-gray-500 mt-1 flex items-center"},$t={__name:"TripTimeline",props:{trip:{type:Object,required:!0}},setup(y){const r=y,f=k(()=>{const p=[];return r.trip.departure_time&&p.push({title:"Departure",time:v(r.trip.departure_time),location:r.trip.origin,completed:!0}),r.trip.checkpoints&&r.trip.checkpoints.forEach(c=>{p.push({title:c.name,time:c.time?v(c.time):"Pending",location:c.location,completed:c.completed})}),r.trip.arrival_time&&p.push({title:"Arrival",time:v(r.trip.arrival_time),location:r.trip.destination,completed:r.trip.status==="Completed"}),p}),v=p=>{if(!p)return"N/A";try{return P(E(p),"HH:mm")}catch{return"Invalid"}};return(p,c)=>(l(),n("div",_t,[c[1]||(c[1]=t("h2",{class:"text-lg font-bold text-gray-800 mb-4"},"Trip Timeline",-1)),t("div",yt,[c[0]||(c[0]=t("div",{class:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"},null,-1)),(l(!0),n(B,null,L(f.value,(u,m)=>(l(),n("div",{key:m,class:"relative pl-10 pb-6 last:pb-0"},[t("div",{class:D(["absolute left-2.5 w-3 h-3 rounded-full",u.completed?"bg-success-600":"bg-gray-300"])},null,2),t("div",null,[t("div",wt,[t("div",bt,i(u.title),1),t("div",kt,i(u.time),1)]),u.description?(l(),n("div",Tt,i(u.description),1)):g("",!0),u.location?(l(),n("div",Ct,[a(s(I),{class:"w-3 h-3 mr-1"}),F(" "+i(u.location),1)])):g("",!0)])]))),128))])]))}};function j(y,r="PPp"){if(!y)return"N/A";try{return P(E(y),r)}catch{return"Invalid Date"}}const Nt={class:"min-h-screen bg-gradient-to-b from-gray-50 to-white"},Dt={class:"sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm"},Ft={class:"flex items-center px-4 py-3"},It={class:"flex-1"},At={class:"text-sm text-gray-500"},Rt=["disabled"],St={key:0,class:"p-8 flex justify-center"},Vt={key:1,class:"p-4"},jt={class:"bg-red-50 border border-red-200 rounded-lg p-4"},Bt={class:"text-red-800"},Lt={key:2,class:"pb-24"},Pt={class:"flex items-center justify-between"},Et={class:"flex items-center space-x-3"},zt={class:"p-2 bg-white/20 rounded-lg"},Mt={class:"mx-4 mt-4 bg-white rounded-xl shadow-card p-5"},qt={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},Ht={class:"space-y-4"},Ot={class:"flex items-start space-x-3"},Ut={class:"p-2 bg-green-100 rounded-lg"},Wt={class:"flex-1"},Gt={class:"text-sm font-medium text-gray-900"},Jt={key:0,class:"text-xs text-gray-600 mt-1"},Kt={class:"flex items-start space-x-3"},Qt={class:"p-2 bg-red-100 rounded-lg"},Xt={class:"flex-1"},Yt={class:"text-sm font-medium text-gray-900"},Zt={key:0,class:"text-xs text-gray-600 mt-1"},te={key:0,class:"pt-3 border-t border-gray-100"},ee={class:"text-sm font-medium text-gray-700"},se={class:"mt-3 space-y-2"},oe={class:"flex-shrink-0 w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center"},ae={class:"text-xs font-semibold text-primary-700"},ie={class:"flex-1 min-w-0"},re={class:"text-sm font-medium text-gray-900 truncate"},le={class:"text-xs text-gray-500"},ne={class:"mx-4 mt-4 bg-white rounded-xl shadow-card p-5"},ce={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},de={class:"space-y-4"},ue={class:"flex items-center space-x-3"},pe={class:"p-3 bg-blue-50 rounded-lg"},me={class:"flex-1"},ve={class:"text-sm font-semibold text-gray-900"},he={class:"text-xs text-gray-600"},xe={class:"flex items-center space-x-3"},ge={class:"p-3 bg-purple-50 rounded-lg"},fe={class:"flex-1"},_e={class:"text-sm font-semibold text-gray-900"},ye={class:"mx-4 mt-4 grid grid-cols-2 gap-3"},we={class:"flex flex-col items-center space-y-2"},be={class:"p-3 bg-orange-100 rounded-full"},ke={class:"flex flex-col items-center space-y-2"},Te={class:"p-3 bg-green-100 rounded-full"},Ce={class:"flex flex-col items-center space-y-2"},$e={class:"p-3 bg-red-100 rounded-full"},Ne={class:"flex flex-col items-center space-y-2"},De={class:"p-3 bg-blue-100 rounded-full"},Fe={key:0,class:"mx-4 mt-4 mb-4 bg-white rounded-xl shadow-card p-5"},Ie={class:"text-sm font-semibold text-gray-900 mb-2 flex items-center"},Ae={class:"text-sm text-gray-600 whitespace-pre-wrap"},ls={__name:"TripDetails",setup(y){const r=st(),f=Y(),v=lt(),p=nt(),{showSuccess:c,showError:u}=useNotification(),m=x(f.params.id),o=x(null),_=x(null),T=x(null),C=x([]),A=x([]),h=x(!1),$=x(null),N=x(!1),M=k(()=>{switch(o.value?.status?.toLowerCase()){case"active":case"in progress":return"bg-gradient-to-r from-green-500 to-green-600";case"completed":return"bg-gradient-to-r from-blue-500 to-blue-600";case"assigned":return"bg-gradient-to-r from-yellow-500 to-yellow-600";default:return"bg-gradient-to-r from-gray-500 to-gray-600"}}),q=k(()=>o.value?.status==="Assigned"),H=k(()=>o.value?.status==="Active"||o.value?.status==="In Progress"),O=k(()=>o.value?.driver||"Not Assigned"),w=async()=>{h.value=!0,$.value=null;try{const d=await v.fetchTripById(m.value);o.value=d,d.route&&(_.value=await v.fetchRouteDetails(d.route),C.value=_.value?.waypoints||[]),d.vehicle&&(T.value=await p.fetchVehicleById(d.vehicle)),A.value=await v.fetchTripEvents(m.value)}catch(d){$.value=d.message||"Failed to load trip details",u("Failed to load trip details")}finally{h.value=!1}},U=async()=>{await w(),c("Trip details refreshed")},W=async()=>{try{h.value=!0,await v.startTrip(m.value),await w(),c("Trip started successfully")}catch(d){u(d.message||"Failed to start trip")}finally{h.value=!1}},G=async()=>{try{h.value=!0,await v.completeTrip(m.value),await w(),c("Trip completed successfully"),r.push("/trips")}catch(d){u(d.message||"Failed to complete trip")}finally{h.value=!1}},J=()=>{r.push(`/inspection?vehicle=${o.value.vehicle}&trip=${m.value}`)},K=()=>{r.push(`/fuel?vehicle=${o.value.vehicle}&trip=${m.value}`)},Q=()=>{r.push(`/incident?trip=${m.value}&vehicle=${o.value.vehicle}`)},X=()=>{if(_.value?.start_location&&_.value?.end_location){const d=`https://www.google.com/maps/dir/?api=1&origin=${_.value.start_location}&destination=${_.value.end_location}`;window.open(d,"_blank")}else u("Navigation data not available")};return Z(()=>{w()}),(d,e)=>(l(),tt(it,null,{default:et(()=>[t("div",Nt,[t("div",Dt,[t("div",Ft,[t("button",{onClick:e[0]||(e[0]=b=>s(r).back()),class:"mr-3 p-2 hover:bg-gray-100 rounded-full transition-colors"},[a(s(gt),{class:"w-6 h-6 text-gray-700"})]),t("div",It,[e[2]||(e[2]=t("h1",{class:"text-lg font-semibold text-gray-900"},"Trip Details",-1)),t("p",At,i(o.value?.name),1)]),t("button",{onClick:U,disabled:h.value,class:"p-2 hover:bg-gray-100 rounded-full transition-colors"},[a(s(ct),{class:D(["w-5 h-5 text-gray-600",{"animate-spin":h.value}])},null,8,["class"])],8,Rt)])]),h.value&&!o.value?(l(),n("div",St,[a(rt)])):$.value?(l(),n("div",Vt,[t("div",jt,[t("p",Bt,i($.value),1),t("button",{onClick:w,class:"mt-2 text-red-600 font-medium"}," Try Again ")])])):o.value?(l(),n("div",Lt,[t("div",{class:D(["mx-4 mt-4 p-4 rounded-xl shadow-soft",M.value])},[t("div",Pt,[t("div",Et,[t("div",zt,[a(s(I),{class:"w-6 h-6 text-white"})]),t("div",null,[e[3]||(e[3]=t("p",{class:"text-white text-sm font-medium"},"Trip Status",-1)),a(S,{status:o.value.status,size:"lg"},null,8,["status"])])]),q.value?(l(),n("button",{key:0,onClick:W,class:"px-4 py-2 bg-white text-green-600 rounded-lg font-medium shadow-md hover:shadow-lg transition-all"}," Start Trip ")):H.value?(l(),n("button",{key:1,onClick:G,class:"px-4 py-2 bg-white text-blue-600 rounded-lg font-medium shadow-md hover:shadow-lg transition-all"}," Complete Trip ")):g("",!0)])],2),t("div",Mt,[t("h2",qt,[a(s(ft),{class:"w-5 h-5 mr-2 text-primary-600"}),e[4]||(e[4]=F(" Route Information ",-1))]),t("div",Ht,[t("div",Ot,[t("div",Ut,[a(s(I),{class:"w-5 h-5 text-green-600"})]),t("div",Wt,[e[5]||(e[5]=t("p",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Origin",-1)),t("p",Gt,i(s(f)?.start_location),1),o.value.start_time?(l(),n("p",Jt,i(s(j)(o.value.start_time)),1)):g("",!0)])]),t("div",Kt,[t("div",Qt,[a(s(I),{class:"w-5 h-5 text-red-600"})]),t("div",Xt,[e[6]||(e[6]=t("p",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Destination",-1)),t("p",Yt,i(s(f)?.end_location),1),o.value.end_time?(l(),n("p",Zt,i(s(j)(o.value.end_time)),1)):g("",!0)])]),C.value?.length?(l(),n("div",te,[t("button",{onClick:e[1]||(e[1]=b=>N.value=!N.value),class:"flex items-center justify-between w-full text-left"},[t("span",ee," Waypoints ("+i(C.value.length)+") ",1),a(s(dt),{class:D(["w-5 h-5 text-gray-400 transition-transform",{"rotate-90":N.value}])},null,8,["class"])]),ot(t("div",se,[(l(!0),n(B,null,L(C.value,(b,R)=>(l(),n("div",{key:R,class:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg"},[t("div",oe,[t("span",ae,i(R+1),1)]),t("div",ie,[t("p",re,i(b.stop_name),1),t("p",le,i(b.stop_type),1)]),a(S,{status:b.completed?"Completed":"Pending",size:"sm"},null,8,["status"])]))),128))],512),[[at,N.value]])])):g("",!0)])]),t("div",ne,[t("h2",ce,[a(s(V),{class:"w-5 h-5 mr-2 text-primary-600"}),e[7]||(e[7]=F(" Vehicle & Assignment ",-1))]),t("div",de,[t("div",ue,[t("div",pe,[a(s(V),{class:"w-6 h-6 text-blue-600"})]),t("div",me,[e[8]||(e[8]=t("p",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Vehicle",-1)),t("p",ve,i(T.value?.license_plate||o.value.vehicle),1),t("p",he,i(T.value?.make)+" "+i(T.value?.model),1)])]),t("div",xe,[t("div",ge,[a(s(ut),{class:"w-6 h-6 text-purple-600"})]),t("div",fe,[e[9]||(e[9]=t("p",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Driver",-1)),t("p",_e,i(O.value),1)])])])]),a($t,{"trip-id":m.value,events:A.value,class:"mx-4 mt-4"},null,8,["trip-id","events"]),t("div",ye,[t("button",{onClick:J,class:"p-4 bg-white rounded-xl shadow-card hover:shadow-lg transition-shadow"},[t("div",we,[t("div",be,[a(s(pt),{class:"w-6 h-6 text-orange-600"})]),e[10]||(e[10]=t("span",{class:"text-sm font-medium text-gray-700"},"Vehicle Check",-1))])]),t("button",{onClick:K,class:"p-4 bg-white rounded-xl shadow-card hover:shadow-lg transition-shadow"},[t("div",ke,[t("div",Te,[a(s(mt),{class:"w-6 h-6 text-green-600"})]),e[11]||(e[11]=t("span",{class:"text-sm font-medium text-gray-700"},"Log Fuel",-1))])]),t("button",{onClick:Q,class:"p-4 bg-white rounded-xl shadow-card hover:shadow-lg transition-shadow"},[t("div",Ce,[t("div",$e,[a(s(vt),{class:"w-6 h-6 text-red-600"})]),e[12]||(e[12]=t("span",{class:"text-sm font-medium text-gray-700"},"Report Issue",-1))])]),t("button",{onClick:X,class:"p-4 bg-white rounded-xl shadow-card hover:shadow-lg transition-shadow"},[t("div",Ne,[t("div",De,[a(s(ht),{class:"w-6 h-6 text-blue-600"})]),e[13]||(e[13]=t("span",{class:"text-sm font-medium text-gray-700"},"Navigate",-1))])])]),o.value.notes?(l(),n("div",Fe,[t("h3",Ie,[a(s(xt),{class:"w-4 h-4 mr-2 text-gray-600"}),e[14]||(e[14]=F(" Notes ",-1))]),t("p",Ae,i(o.value.notes),1)])):g("",!0)])):g("",!0)])]),_:1}))}};export{ls as default};
//# sourceMappingURL=TripDetails-B9_GeWSg.js.map
