import{x as R,r as n,j as S,u as q,o as G,c as g,b as e,l as o,k as f,t as i,h as T,F as I,s as W,p as $,i as y,e as N,w as H,f as J,A as Q,v as X}from"./vue-vendor-Drzz9AVS.js";import{f as V}from"./index-Ddao6l4m.js";import{u as Y}from"./useGeolocation-D92nn38v.js";import{_ as Z}from"./LoadingSpinner-8TgqN-e3.js";import{_ as ee}from"./EmptyState-DMTapcdr.js";import{C as te,_ as se}from"./StatusBadge-BRll2oj-.js";import{M as P}from"./Modal--Nc8TLzj.js";import{T as ae}from"./Toast-iY29jcEz.js";import{A as le,S as F}from"./scan-CGZ5W3vi.js";import{P as U}from"./package-De-QoVLn.js";import{C as oe}from"./circle-x-C5bF3VpG.js";import{S as ne}from"./square-pen-RyzGw0DN.js";import"./utils-DGK9-2WQ.js";import"./createLucideIcon-_YMTRyyK.js";import"./circle-alert-CoqcVHEx.js";import"./x-BTQ7jAj7.js";import"./info-SOydNe6P.js";import"./triangle-alert-C4Mkg0bL.js";const re=R("cargo",()=>{const w=n([]),v=n(!1),r=n(null);async function D(d){v.value=!0,r.value=null;try{const a=await V.call("tems.api.pwa.driver.get_cargo_consignments",{trip_id:d});return w.value=a||[],a}catch(a){throw r.value=a.message,a}finally{v.value=!1}}async function x(d,a){v.value=!0;try{return await V.call("tems.api.pwa.driver.scan_cargo_barcode",{barcode:d,trip_id:a})}catch(u){throw r.value=u.message,u}finally{v.value=!1}}async function _(d,a,u,m=null){v.value=!0;try{const c=await V.call("tems.api.pwa.driver.update_delivery_status",{consignment_id:d,status:a,location_data:u,signature:m,timestamp:new Date().toISOString()}),p=w.value.find(b=>b.name===d);return p&&(p.status=a),c}catch(c){throw r.value=c.message,c}finally{v.value=!1}}return{consignments:w,loading:v,error:r,fetchConsignments:D,scanBarcode:x,updateDeliveryStatus:_}}),ie={class:"space-y-6"},ue={class:"card p-4"},de={class:"flex items-center justify-between mb-2"},ce={class:"flex items-center space-x-3"},ve={class:"text-sm text-gray-600"},me={class:"grid grid-cols-3 gap-3"},pe={class:"card p-4 text-center"},ge={class:"text-2xl font-bold text-gray-900"},fe={class:"card p-4 text-center"},ye={class:"text-2xl font-bold text-gray-900"},xe={class:"card p-4 text-center"},_e={class:"text-2xl font-bold text-gray-900"},be={class:"card"},he={key:0,class:"p-8"},Ce={key:1,class:"p-8"},we={key:2,class:"divide-y"},ke=["onClick"],Se={class:"flex items-start justify-between mb-2"},De={class:"flex-1"},Ve={class:"flex items-center space-x-2 mb-1"},Be={class:"font-semibold text-gray-900"},Me={class:"text-sm text-gray-600"},Te=["onClick"],$e={class:"grid grid-cols-2 gap-3 mt-3 text-sm"},Ne={class:"font-medium text-gray-900"},Pe={class:"font-medium text-gray-900"},Fe={class:"font-medium text-gray-900"},Ue={class:"space-y-4"},je={class:"p-4 bg-gray-100 rounded-lg text-center"},Ae={class:"mt-4"},Ee={class:"flex space-x-2"},Le=["disabled"],ze={key:0,class:"space-y-4"},Ke={class:"p-4 bg-gray-50 rounded-lg"},Oe={class:"font-semibold text-gray-900"},Re={class:"font-medium text-gray-900"},qe={class:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center"},Ge={class:"flex space-x-2"},Ie=["disabled"],ct={__name:"CargoManagement",setup(w){const v=q(),r=re(),{getCurrentPosition:D}=Y(),x=S(()=>v.params.id),_=S(()=>r.consignments),d=n(!1),a=n(!1),u=n(!1),m=n(!1),c=n("success"),p=n(""),b=n(""),C=n(""),h=n(null),k=n(!1),j=S(()=>_.value.filter(l=>l.status==="Delivered").length),A=S(()=>_.value.filter(l=>l.status!=="Delivered").length);function E(){a.value=!0,C.value=""}async function B(){if(C.value)try{const l=await r.scanBarcode(C.value,x.value);c.value="success",p.value="Scanned",b.value="Consignment found",m.value=!0,a.value=!1,await r.fetchConsignments(x.value)}catch(l){c.value="error",p.value="Error",b.value=l.message||"Failed to scan barcode",m.value=!0}}function L(l){h.value=l,l.status!=="Delivered"&&(u.value=!0)}async function M(l,t){k.value=!0;try{const s=await D();await r.updateDeliveryStatus(l.name,t,{lat:s.latitude,lng:s.longitude}),c.value="success",p.value="Updated",b.value="Delivery status updated successfully",m.value=!0,await r.fetchConsignments(x.value)}catch(s){c.value="error",p.value="Error",b.value=s.message||"Failed to update status",m.value=!0}finally{k.value=!1}}function z(){console.log("Capture signature")}async function K(){h.value&&(await M(h.value,"Delivered"),u.value=!1,h.value=null)}return G(async()=>{d.value=!0;try{await r.fetchConsignments(x.value)}finally{d.value=!1}}),(l,t)=>(y(),g("div",ie,[e("div",ue,[e("div",de,[e("div",ce,[e("button",{onClick:t[0]||(t[0]=s=>l.$router.back()),class:"btn-secondary p-2"},[o(f(le),{class:"w-5 h-5"})]),e("div",null,[t[7]||(t[7]=e("h2",{class:"text-xl font-bold text-gray-900"},"Cargo Management",-1)),e("p",ve,"Trip "+i(x.value),1)])]),e("button",{onClick:E,class:"btn-primary"},[o(f(F),{class:"w-5 h-5 mr-2"}),t[8]||(t[8]=T(" Scan ",-1))])])]),e("div",me,[e("div",pe,[o(f(U),{class:"w-6 h-6 mx-auto mb-2 text-primary-600"}),e("p",ge,i(_.value.length),1),t[9]||(t[9]=e("p",{class:"text-xs text-gray-600"},"Total",-1))]),e("div",fe,[o(f(oe),{class:"w-6 h-6 mx-auto mb-2 text-green-600"}),e("p",ye,i(j.value),1),t[10]||(t[10]=e("p",{class:"text-xs text-gray-600"},"Delivered",-1))]),e("div",xe,[o(f(te),{class:"w-6 h-6 mx-auto mb-2 text-amber-600"}),e("p",_e,i(A.value),1),t[11]||(t[11]=e("p",{class:"text-xs text-gray-600"},"Pending",-1))])]),e("div",be,[t[15]||(t[15]=e("div",{class:"p-4 border-b"},[e("h3",{class:"font-semibold text-gray-900"},"Consignments")],-1)),d.value?(y(),g("div",he,[o(Z,{message:"Loading consignments..."})])):_.value.length===0?(y(),g("div",Ce,[o(ee,{icon:f(U),title:"No cargo",message:"No cargo consignments assigned to this trip."},null,8,["icon"])])):(y(),g("div",we,[(y(!0),g(I,null,W(_.value,s=>(y(),g("div",{key:s.name,class:"p-4 hover:bg-gray-50 cursor-pointer",onClick:O=>L(s)},[e("div",Se,[e("div",De,[e("div",Ve,[e("p",Be,i(s.consignment_no),1),o(se,{status:s.status},null,8,["status"])]),e("p",Me,i(s.tracking_no),1)]),s.status!=="Delivered"?(y(),g("button",{key:0,onClick:H(O=>M(s,"Delivered"),["stop"]),class:"btn-sm btn-primary"}," Mark Delivered ",8,Te)):N("",!0)]),e("div",$e,[e("div",null,[t[12]||(t[12]=e("p",{class:"text-gray-500"},"From",-1)),e("p",Ne,i(s.sender),1)]),e("div",null,[t[13]||(t[13]=e("p",{class:"text-gray-500"},"To",-1)),e("p",Pe,i(s.receiver),1)]),e("div",null,[t[14]||(t[14]=e("p",{class:"text-gray-500"},"Weight",-1)),e("p",Fe,i(s.weight)+" kg",1)])])],8,ke))),128))]))]),o(P,{modelValue:a.value,"onUpdate:modelValue":t[3]||(t[3]=s=>a.value=s),title:"Scan Barcode",size:"lg"},{default:$(()=>[e("div",Ue,[e("div",je,[o(f(F),{class:"w-16 h-16 mx-auto mb-4 text-gray-400"}),t[16]||(t[16]=e("p",{class:"text-gray-600 mb-4"},"Position the barcode within the frame",-1)),e("div",Ae,[J(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>C.value=s),type:"text",placeholder:"Or enter tracking number manually",class:"w-full px-4 py-2 border rounded-lg",onKeydown:Q(B,["enter"])},null,544),[[X,C.value]])])]),e("div",Ee,[e("button",{onClick:t[2]||(t[2]=s=>a.value=!1),class:"flex-1 btn-secondary"}," Cancel "),e("button",{onClick:B,class:"flex-1 btn-primary",disabled:!C.value}," Scan ",8,Le)])])]),_:1},8,["modelValue"]),o(P,{modelValue:u.value,"onUpdate:modelValue":t[5]||(t[5]=s=>u.value=s),title:"Confirm Delivery",size:"md"},{default:$(()=>[h.value?(y(),g("div",ze,[e("div",Ke,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600"},"Consignment",-1)),e("p",Oe,i(h.value.consignment_no),1),t[18]||(t[18]=e("p",{class:"text-sm text-gray-600 mt-2"},"Receiver",-1)),e("p",Re,i(h.value.receiver),1)]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Signature ",-1)),e("div",qe,[e("button",{onClick:z,class:"btn-secondary"},[o(f(ne),{class:"w-5 h-5 mr-2"}),t[19]||(t[19]=T(" Capture Signature ",-1))])])]),e("div",Ge,[e("button",{onClick:t[4]||(t[4]=s=>u.value=!1),class:"flex-1 btn-secondary"}," Cancel "),e("button",{onClick:K,class:"flex-1 btn-primary",disabled:k.value},i(k.value?"Confirming...":"Confirm Delivery"),9,Ie)])])):N("",!0)]),_:1},8,["modelValue"]),o(ae,{modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=s=>m.value=s),type:c.value,title:p.value,message:b.value},null,8,["modelValue","type","title","message"])]))}};export{ct as default};
//# sourceMappingURL=CargoManagement-DgGwdzzH.js.map
