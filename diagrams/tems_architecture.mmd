%% TEMS Architecture Diagram - Layered Component View
%% Generated by AI Architect Agent - October 16, 2025
%% Render with: mmdc -i tems_architecture.mmd -o tems_architecture.png -t dark -b transparent

graph TB
    subgraph "Presentation Layer"
        A1[Desk UI<br/>Frappe Workspace]
        A2[Web Portal<br/>Customer/Driver]
        A3[Mobile PWA<br/>Driver App]
        A4[API Gateway<br/>REST/WebSocket]
    end
    
    subgraph "Application Layer - TEMS Domains"
        B1[tems_operations<br/>Core Execution]
        B2[tems_fleet<br/>Vehicle & Asset]
        B3[tems_safety<br/>Risk & Compliance]
        B4[tems_finance<br/>Profitability]
        B5[tems_cargo<br/>Freight Ops]
        B6[tems_passenger<br/>Transit Ops]
        B7[tems_tyre<br/>Lifecycle]
        B8[tems_ai<br/>ML Insights]
        B9[tems_people<br/>HRMS Extension]
        B10[tems_trade<br/>Cross-Border]
        B11[tems_governance<br/>Policy & Audit]
        B12[tems_climate<br/>Emissions]
        B13[tems_insights<br/>Analytics]
    end
    
    subgraph "Core Services Layer"
        C1[Vehicle Hub<br/>Central Entity]
        C2[Asset Management<br/>Lifecycle Tracking]
        C3[Cost Rollup Engine<br/>Financial Aggregation]
        C4[Event Bus<br/>Real-time Events]
        C5[Scheduler<br/>Background Jobs]
        C6[Hooks Registry<br/>Doc Events]
    end
    
    subgraph "ERPNext Foundation"
        D1[Vehicle DocType]
        D2[Asset DocType]
        D3[Employee DocType]
        D4[Customer DocType]
        D5[Supplier DocType]
        D6[Stock Entry]
        D7[Purchase Order]
    end
    
    subgraph "Data Layer"
        E1[(MariaDB<br/>Transactional)]
        E2[(Redis<br/>Cache & Queue)]
        E3[(File Storage<br/>S3/Local)]
    end
    
    subgraph "External Integrations"
        F1[IoT Sensors<br/>TPMS/GPS]
        F2[AI Services<br/>OpenAI/Azure ML]
        F3[Payment Gateway<br/>Mobile Money]
        F4[USSD Provider<br/>Informal Ops]
        F5[WhatsApp API<br/>Notifications]
    end
    
    %% Presentation to Application
    A1 --> B1
    A1 --> B2
    A1 --> B3
    A1 --> B4
    A2 --> B5
    A2 --> B6
    A3 --> B9
    A4 --> B7
    A4 --> B8
    
    %% Application to Core Services
    B1 --> C1
    B2 --> C1
    B2 --> C2
    B3 --> C1
    B4 --> C3
    B5 --> C1
    B6 --> C1
    B7 --> C2
    B8 --> C4
    B9 --> C6
    B10 --> C1
    B11 --> C6
    B12 --> C4
    B13 --> C3
    
    %% Core Services to ERPNext
    C1 --> D1
    C2 --> D2
    C3 --> D1
    C3 --> D2
    C4 --> D1
    C5 --> D1
    C5 --> D2
    C6 --> D1
    C6 --> D3
    
    %% ERPNext to Data
    D1 --> E1
    D2 --> E1
    D3 --> E1
    D4 --> E1
    D5 --> E1
    D6 --> E1
    D7 --> E1
    C4 --> E2
    C5 --> E2
    B8 --> E3
    
    %% External Integrations
    F1 --> A4
    A4 --> B7
    B8 --> F2
    B6 --> F3
    B1 --> F4
    B3 --> F5
    
    %% Styling
    classDef presentation fill:#4A90E2,stroke:#2E5C8A,color:#fff
    classDef application fill:#7ED321,stroke:#5A9C18,color:#000
    classDef core fill:#F5A623,stroke:#C77D0A,color:#000
    classDef erpnext fill:#BD10E0,stroke:#8A0BA8,color:#fff
    classDef data fill:#50E3C2,stroke:#2FA88F,color:#000
    classDef external fill:#D0021B,stroke:#950115,color:#fff
    
    class A1,A2,A3,A4 presentation
    class B1,B2,B3,B4,B5,B6,B7,B8,B9,B10,B11,B12,B13 application
    class C1,C2,C3,C4,C5,C6 core
    class D1,D2,D3,D4,D5,D6,D7 erpnext
    class E1,E2,E3 data
    class F1,F2,F3,F4,F5 external
