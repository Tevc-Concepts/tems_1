import{x as w,r,j as h}from"./vue-vendor-Drzz9AVS.js";import{f as c}from"./index-Ddao6l4m.js";const _=w("communication",()=>{const u=r([]),i=r([]),o=r(0),a=r(!1),n=r(null),f=h(()=>i.value.filter(e=>!e.read));async function m(){a.value=!0,n.value=null;try{const e=await c.call("tems.api.pwa.driver.get_messages");return u.value=e||[],e}catch(e){throw n.value=e.message,e}finally{a.value=!1}}async function v(e,t,l){a.value=!0;try{const s=await c.call("tems.api.pwa.driver.send_message",{recipient_type:e,recipient_id:t,message:l,timestamp:new Date().toISOString()});return u.value.push({...s,sender:"me",message:l,timestamp:new Date().toISOString()}),s}catch(s){throw n.value=s.message,s}finally{a.value=!1}}async function d(){a.value=!0;try{const e=await c.call("tems.api.pwa.driver.get_notifications");return i.value=e||[],o.value=f.value.length,e}catch(e){throw n.value=e.message,e}finally{a.value=!1}}async function p(e){try{await c.call("tems.api.pwa.driver.mark_notification_read",{notification_id:e});const t=i.value.find(l=>l.name===e);t&&(t.read=!0,o.value=f.value.length)}catch(t){throw n.value=t.message,t}}function g(e){i.value.unshift({...e,read:!1,timestamp:new Date().toISOString()}),o.value++}return{messages:u,notifications:i,unreadCount:o,unreadNotifications:f,loading:a,error:n,fetchMessages:m,sendMessage:v,fetchNotifications:d,markNotificationRead:p,addLocalNotification:g}});export{_ as u};
//# sourceMappingURL=communication-DWD2staR.js.map
