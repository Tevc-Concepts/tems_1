%% TEMS Data Flow - Purchase to Insights
%% Generated by AI Architect Agent - October 16, 2025
%% Canonical flow: Purchase → Stock → Asset → Vehicle → Operation → Finance → Insights

sequenceDiagram
    participant PO as Purchase Order
    participant SE as Stock Entry
    participant A as Asset
    participant V as Vehicle
    participant T as Tyre<br/>(if applicable)
    participant OP as Operation Plan
    participant ML as Movement Log
    participant CRL as Cost & Revenue<br/>Ledger
    participant FC as Fleet Costs
    participant INS as Insights<br/>Dashboard
    participant AI as AI Engine
    
    Note over PO,AI: Data Lineage: Procurement → Operations → Finance → Analytics
    
    %% Procurement Phase
    PO->>SE: Submit PO<br/>Create Stock Entry
    SE->>A: Stock Receipt<br/>Create Asset
    Note over A: Asset Category:<br/>Vehicle, Tyre, Equipment
    
    %% Asset Assignment Phase
    alt Asset is Tyre
        A->>T: Link Asset to Tyre
        T->>V: Install Tyre on Vehicle
        Note over T,V: Many Tyres → One Vehicle
    else Asset is Vehicle Component
        A->>V: Link Asset to Vehicle
        Note over A,V: Many Assets → One Vehicle
    end
    
    %% Operations Phase
    V->>OP: Vehicle assigned to<br/>Operation Plan
    Note over OP: Validates:<br/>- Vehicle Type (Cargo/Passenger)<br/>- Driver Assignment<br/>- Vehicle Availability
    
    OP->>ML: Generate Movement Logs<br/>(Check-In, In Transit, Delivered)
    Note over ML: Real-time tracking<br/>Location, State, Timestamp
    
    %% Cost Capture Phase
    par Cost Accumulation
        A->>CRL: Asset Maintenance Cost
        T->>CRL: Tyre Inspection/Replacement Cost
        OP->>CRL: Operational Costs (Fuel, Tolls)
        V->>FC: Vehicle-level Cost Rollup
    end
    
    %% Revenue Capture Phase
    OP->>CRL: Operational Revenue<br/>(Trip Payment)
    Note over CRL: Type: Revenue<br/>Linked to Vehicle
    
    %% Financial Rollup Phase
    CRL->>V: Update Vehicle Profitability
    Note over V: Profitability =<br/>Sum(Revenue) - Sum(Costs)
    
    FC->>V: Aggregate Fleet Costs
    V->>INS: Push to Insights Dashboard
    
    %% AI Analytics Phase
    V->>AI: Vehicle data<br/>(Odometer, Costs, Utilization)
    T->>AI: Tyre data<br/>(Health, Wear Rate)
    OP->>AI: Operation data<br/>(ETA, Route Efficiency)
    
    AI->>AI: Generate Predictions:<br/>- Maintenance Schedule<br/>- Tyre Replacement<br/>- Profitability Forecast
    
    AI->>INS: AI Insight Logs<br/>(Confidence Scores, Alerts)
    
    %% Dashboard Visualization
    INS->>INS: Aggregate Metrics:<br/>- Vehicle Health Score<br/>- Cost per KM<br/>- Fleet ROI<br/>- Predictive Alerts
    
    Note over INS: Dashboards accessible by:<br/>Fleet Manager, Finance Manager,<br/>Operations Manager, Executive
