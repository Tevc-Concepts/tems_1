{"version":3,"file":"CameraModal-DegDuRgw.js","sources":["../../../../../../frontend/node_modules/lucide-vue-next/dist/esm/icons/camera.js","../../../../../../frontend/driver-pwa/src/composables/useMedia.js","../../../../../../frontend/driver-pwa/src/components/common/CameraModal.vue"],"sourcesContent":["/**\n * @license lucide-vue-next v0.545.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Camera = createLucideIcon(\"camera\", [\n  [\n    \"path\",\n    {\n      d: \"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z\",\n      key: \"18u6gg\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"13\", r: \"3\", key: \"1vg3eu\" }]\n]);\n\nexport { Camera as default };\n//# sourceMappingURL=camera.js.map\n","import { ref, computed } from 'vue'\n\nexport function useCamera() {\n    const stream = ref(null)\n    const videoElement = ref(null)\n    const error = ref(null)\n    const isActive = ref(false)\n\n    const isCameraSupported = computed(() => {\n        return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)\n    })\n\n    async function startCamera(videoRef, facingMode = 'environment') {\n        if (!isCameraSupported.value) {\n            error.value = new Error('Camera not supported on this device')\n            throw error.value\n        }\n\n        try {\n            const constraints = {\n                video: {\n                    facingMode: facingMode, // 'user' for front camera, 'environment' for back\n                    width: { ideal: 1920 },\n                    height: { ideal: 1080 }\n                },\n                audio: false\n            }\n\n            stream.value = await navigator.mediaDevices.getUserMedia(constraints)\n\n            if (videoRef) {\n                videoElement.value = videoRef\n                videoRef.srcObject = stream.value\n                await videoRef.play()\n                isActive.value = true\n            }\n\n            return stream.value\n        } catch (err) {\n            error.value = err\n            throw err\n        }\n    }\n\n    function stopCamera() {\n        if (stream.value) {\n            stream.value.getTracks().forEach(track => track.stop())\n            stream.value = null\n            isActive.value = false\n        }\n\n        if (videoElement.value) {\n            videoElement.value.srcObject = null\n        }\n    }\n\n    function capturePhoto() {\n        if (!videoElement.value || !isActive.value) {\n            throw new Error('Camera not active')\n        }\n\n        const canvas = document.createElement('canvas')\n        canvas.width = videoElement.value.videoWidth\n        canvas.height = videoElement.value.videoHeight\n\n        const ctx = canvas.getContext('2d')\n        ctx.drawImage(videoElement.value, 0, 0)\n\n        return new Promise((resolve) => {\n            canvas.toBlob((blob) => {\n                resolve({\n                    blob: blob,\n                    dataUrl: canvas.toDataURL('image/jpeg', 0.9)\n                })\n            }, 'image/jpeg', 0.9)\n        })\n    }\n\n    async function switchCamera() {\n        if (!isActive.value) return\n\n        const currentFacingMode = stream.value\n            .getVideoTracks()[0]\n            .getSettings().facingMode\n\n        const newFacingMode = currentFacingMode === 'user' ? 'environment' : 'user'\n\n        stopCamera()\n        await startCamera(videoElement.value, newFacingMode)\n    }\n\n    return {\n        stream,\n        videoElement,\n        error,\n        isActive,\n        isCameraSupported,\n        startCamera,\n        stopCamera,\n        capturePhoto,\n        switchCamera\n    }\n}\n\n// Voice recording composable\nexport function useVoiceRecorder() {\n    const mediaRecorder = ref(null)\n    const audioChunks = ref([])\n    const isRecording = ref(false)\n    const error = ref(null)\n    const recordingDuration = ref(0)\n    const durationInterval = ref(null)\n\n    const isSupported = computed(() => {\n        return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)\n    })\n\n    async function startRecording() {\n        if (!isSupported.value) {\n            error.value = new Error('Audio recording not supported')\n            throw error.value\n        }\n\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\n\n            mediaRecorder.value = new MediaRecorder(stream)\n            audioChunks.value = []\n            recordingDuration.value = 0\n\n            mediaRecorder.value.ondataavailable = (event) => {\n                if (event.data.size > 0) {\n                    audioChunks.value.push(event.data)\n                }\n            }\n\n            mediaRecorder.value.start()\n            isRecording.value = true\n\n            // Track duration\n            durationInterval.value = setInterval(() => {\n                recordingDuration.value++\n            }, 1000)\n\n        } catch (err) {\n            error.value = err\n            throw err\n        }\n    }\n\n    function stopRecording() {\n        return new Promise((resolve) => {\n            if (!mediaRecorder.value || !isRecording.value) {\n                resolve(null)\n                return\n            }\n\n            mediaRecorder.value.onstop = () => {\n                const audioBlob = new Blob(audioChunks.value, { type: 'audio/webm' })\n\n                // Stop all tracks\n                mediaRecorder.value.stream.getTracks().forEach(track => track.stop())\n\n                isRecording.value = false\n                clearInterval(durationInterval.value)\n\n                resolve({\n                    blob: audioBlob,\n                    duration: recordingDuration.value\n                })\n            }\n\n            mediaRecorder.value.stop()\n        })\n    }\n\n    function cancelRecording() {\n        if (mediaRecorder.value && isRecording.value) {\n            mediaRecorder.value.stop()\n            mediaRecorder.value.stream.getTracks().forEach(track => track.stop())\n            isRecording.value = false\n            clearInterval(durationInterval.value)\n            audioChunks.value = []\n            recordingDuration.value = 0\n        }\n    }\n\n    return {\n        isRecording,\n        error,\n        isSupported,\n        recordingDuration,\n        startRecording,\n        stopRecording,\n        cancelRecording\n    }\n}\n","<template>\n  <Modal :model-value=\"modelValue\" @update:model-value=\"emit('update:modelValue', $event)\" title=\"Take Photo\" size=\"lg\" full-height>\n    <div class=\"space-y-4\">\n      <!-- Video Preview -->\n      <div class=\"relative bg-black rounded-lg overflow-hidden\" style=\"aspect-ratio: 4/3;\">\n        <video\n          ref=\"videoElement\"\n          autoplay\n          playsinline\n          class=\"w-full h-full object-cover\"\n        ></video>\n        \n        <div v-if=\"!isActive\" class=\"absolute inset-0 flex items-center justify-center bg-black/50\">\n          <p class=\"text-white\">Initializing camera...</p>\n        </div>\n      </div>\n\n      <!-- Controls -->\n      <div class=\"flex items-center justify-center space-x-4\">\n        <button\n          type=\"button\"\n          @click=\"switchCamera\"\n          class=\"btn-secondary p-3\"\n          :disabled=\"!isActive\"\n        >\n          <RefreshCw class=\"w-6 h-6\" />\n        </button>\n\n        <button\n          type=\"button\"\n          @click=\"capture\"\n          class=\"w-16 h-16 bg-primary-600 hover:bg-primary-700 rounded-full flex items-center justify-center shadow-lg active:scale-95 transition-transform\"\n          :disabled=\"!isActive\"\n        >\n          <Camera class=\"w-8 h-8 text-white\" />\n        </button>\n\n        <button\n          type=\"button\"\n          @click=\"close\"\n          class=\"btn-secondary p-3\"\n        >\n          <X class=\"w-6 h-6\" />\n        </button>\n      </div>\n\n      <p v-if=\"error\" class=\"text-sm text-red-600 text-center\">{{ error }}</p>\n    </div>\n  </Modal>\n</template>\n\n<script setup>\nimport { ref, watch, onUnmounted } from 'vue'\nimport { Camera, RefreshCw, X } from 'lucide-vue-next'\nimport { useCamera } from '@/composables/useMedia'\nimport Modal from './Modal.vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: Boolean,\n    required: true\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'capture'])\n\nconst videoElement = ref(null)\nconst { isActive, error, startCamera, stopCamera, capturePhoto, switchCamera: toggleCamera } = useCamera()\n\nwatch(() => props.modelValue, async (newVal) => {\n  if (newVal && videoElement.value) {\n    try {\n      await startCamera(videoElement.value)\n    } catch (err) {\n      console.error('Failed to start camera:', err)\n    }\n  } else if (!newVal) {\n    stopCamera()\n  }\n})\n\nasync function switchCamera() {\n  await toggleCamera()\n}\n\nasync function capture() {\n  try {\n    const photo = await capturePhoto()\n    emit('capture', photo)\n    close()\n  } catch (err) {\n    console.error('Failed to capture photo:', err)\n  }\n}\n\nfunction close() {\n  stopCamera()\n  emit('update:modelValue', false)\n}\n\nonUnmounted(() => {\n  stopCamera()\n})\n</script>\n"],"names":["Camera","createLucideIcon","useCamera","stream","ref","videoElement","error","isActive","isCameraSupported","computed","startCamera","videoRef","facingMode","constraints","err","stopCamera","track","capturePhoto","canvas","resolve","blob","switchCamera","newFacingMode","props","__props","emit","__emit","toggleCamera","watch","newVal","capture","photo","close","onUnmounted","_createBlock","Modal","_cache","$event","_createElementVNode","_hoisted_1","_hoisted_2","_unref","_openBlock","_createElementBlock","_hoisted_3","_hoisted_4","_createVNode","RefreshCw","X","_hoisted_7","_toDisplayString"],"mappings":"6SAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASK,MAACA,EAASC,EAAiB,SAAU,CACxC,CACE,OACA,CACE,EAAG,qLACH,IAAK,QACX,CACA,EACE,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,IAAK,IAAK,QAAQ,CAAE,CAC1D,CAAC,EChBM,SAASC,GAAY,CACxB,MAAMC,EAASC,EAAI,IAAI,EACjBC,EAAeD,EAAI,IAAI,EACvBE,EAAQF,EAAI,IAAI,EAChBG,EAAWH,EAAI,EAAK,EAEpBI,EAAoBC,EAAS,IACxB,CAAC,EAAE,UAAU,cAAgB,UAAU,aAAa,aAC9D,EAED,eAAeC,EAAYC,EAAUC,EAAa,cAAe,CAC7D,GAAI,CAACJ,EAAkB,MACnB,MAAAF,EAAM,MAAQ,IAAI,MAAM,qCAAqC,EACvDA,EAAM,MAGhB,GAAI,CACA,MAAMO,EAAc,CAChB,MAAO,CACH,WAAYD,EACZ,MAAO,CAAE,MAAO,IAAI,EACpB,OAAQ,CAAE,MAAO,IAAI,CACzC,EACgB,MAAO,EACvB,EAEY,OAAAT,EAAO,MAAQ,MAAM,UAAU,aAAa,aAAaU,CAAW,EAEhEF,IACAN,EAAa,MAAQM,EACrBA,EAAS,UAAYR,EAAO,MAC5B,MAAMQ,EAAS,KAAI,EACnBJ,EAAS,MAAQ,IAGdJ,EAAO,KAClB,OAASW,EAAK,CACV,MAAAR,EAAM,MAAQQ,EACRA,CACV,CACJ,CAEA,SAASC,GAAa,CACdZ,EAAO,QACPA,EAAO,MAAM,UAAS,EAAG,QAAQa,GAASA,EAAM,KAAI,CAAE,EACtDb,EAAO,MAAQ,KACfI,EAAS,MAAQ,IAGjBF,EAAa,QACbA,EAAa,MAAM,UAAY,KAEvC,CAEA,SAASY,GAAe,CACpB,GAAI,CAACZ,EAAa,OAAS,CAACE,EAAS,MACjC,MAAM,IAAI,MAAM,mBAAmB,EAGvC,MAAMW,EAAS,SAAS,cAAc,QAAQ,EAC9C,OAAAA,EAAO,MAAQb,EAAa,MAAM,WAClCa,EAAO,OAASb,EAAa,MAAM,YAEvBa,EAAO,WAAW,IAAI,EAC9B,UAAUb,EAAa,MAAO,EAAG,CAAC,EAE/B,IAAI,QAASc,GAAY,CAC5BD,EAAO,OAAQE,GAAS,CACpBD,EAAQ,CACJ,KAAMC,EACN,QAASF,EAAO,UAAU,aAAc,EAAG,CAC/D,CAAiB,CACL,EAAG,aAAc,EAAG,CACxB,CAAC,CACL,CAEA,eAAeG,GAAe,CAC1B,GAAI,CAACd,EAAS,MAAO,OAMrB,MAAMe,EAJoBnB,EAAO,MAC5B,eAAc,EAAG,CAAC,EAClB,cAAc,aAEyB,OAAS,cAAgB,OAErEY,EAAU,EACV,MAAML,EAAYL,EAAa,MAAOiB,CAAa,CACvD,CAEA,MAAO,CACH,OAAAnB,EACA,aAAAE,EACA,MAAAC,EACA,SAAAC,EACA,kBAAAC,EACA,YAAAE,EACA,WAAAK,EACA,aAAAE,EACA,aAAAI,CACR,CACA,ycC7CA,MAAME,EAAQC,EAORC,EAAOC,EAEPrB,EAAeD,EAAI,IAAI,EACvB,CAAE,SAAAG,EAAU,MAAAD,EAAO,YAAAI,EAAa,WAAAK,EAAY,aAAAE,EAAc,aAAcU,CAAY,EAAKzB,EAAS,EAExG0B,EAAM,IAAML,EAAM,WAAY,MAAOM,GAAW,CAC9C,GAAIA,GAAUxB,EAAa,MACzB,GAAI,CACF,MAAMK,EAAYL,EAAa,KAAK,CACtC,OAASS,EAAK,CACZ,QAAQ,MAAM,0BAA2BA,CAAG,CAC9C,MACUe,GACVd,EAAU,CAEd,CAAC,EAED,eAAeM,GAAe,CAC5B,MAAMM,EAAY,CACpB,CAEA,eAAeG,GAAU,CACvB,GAAI,CACF,MAAMC,EAAQ,MAAMd,EAAY,EAChCQ,EAAK,UAAWM,CAAK,EACrBC,EAAK,CACP,OAASlB,EAAK,CACZ,QAAQ,MAAM,2BAA4BA,CAAG,CAC/C,CACF,CAEA,SAASkB,GAAQ,CACfjB,EAAU,EACVU,EAAK,oBAAqB,EAAK,CACjC,CAEA,OAAAQ,EAAY,IAAM,CAChBlB,EAAU,CACZ,CAAC,cArGCmB,EA+CQC,EAAA,CA/CA,cAAaX,EAAA,WAAa,sBAAkBY,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAEZ,EAAI,oBAAsBY,CAAM,GAAG,MAAM,aAAa,KAAK,KAAK,cAAA,eACpH,IA6CM,CA7CNC,EA6CM,MA7CNC,EA6CM,CA3CJD,EAWM,MAXNE,EAWM,CAVJF,EAKS,QAAA,SAJH,eAAJ,IAAIjC,EACJ,SAAA,GACA,YAAA,GACA,MAAM,wCAGIoC,EAAAlC,CAAA,YAAZmC,IAAAC,EAEM,MAFNC,EAEM,CAAA,GAAAR,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CADJE,EAAgD,IAAA,CAA7C,MAAM,YAAY,EAAC,yBAAsB,EAAA,SAKhDA,EA0BM,MA1BNO,EA0BM,CAzBJP,EAOS,SAAA,CANP,KAAK,SACJ,QAAOjB,EACR,MAAM,oBACL,UAAWoB,EAAAlC,CAAA,IAEZuC,EAA6BL,EAAAM,CAAA,EAAA,CAAlB,MAAM,SAAS,CAAA,QAG5BT,EAOS,SAAA,CANP,KAAK,SACJ,QAAOR,EACR,MAAM,6IACL,UAAWW,EAAAlC,CAAA,IAEZuC,EAAqCL,EAAAzC,CAAA,EAAA,CAA7B,MAAM,oBAAoB,CAAA,QAGpCsC,EAMS,SAAA,CALP,KAAK,SACJ,QAAON,EACR,MAAM,sBAENc,EAAqBL,EAAAO,CAAA,EAAA,CAAlB,MAAM,SAAS,CAAA,MAIbP,EAAAnC,CAAA,OAATqC,EAAwE,IAAxEM,EAAwEC,EAAZT,EAAAnC,CAAA,CAAK,EAAA,CAAA","x_google_ignoreList":[0]}