{"version":3,"file":"incident-D0Jc3bXl.js","sources":["../../../../../../frontend/driver-pwa/src/stores/incident.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport { frappeClient } from '@shared'\n\nexport const useIncidentStore = defineStore('incident', () => {\n    const incidents = ref([])\n    const loading = ref(false)\n    const error = ref(null)\n\n    async function reportIncident(incidentData) {\n        loading.value = true\n        error.value = null\n\n        try {\n            const result = await frappeClient.call('tems.api.pwa.driver.report_incident', {\n                data: incidentData\n            })\n\n            // Add to local list\n            incidents.value.unshift({\n                name: result.incident,\n                ...incidentData,\n                status: 'Open',\n                created: new Date().toISOString()\n            })\n\n            return result\n        } catch (err) {\n            error.value = err.message\n            throw err\n        } finally {\n            loading.value = false\n        }\n    }\n\n    async function uploadIncidentPhoto(file, incidentName = null) {\n        try {\n            const uploadResult = await frappeClient.uploadFile(\n                file,\n                true,\n                'Home/Incidents'\n            )\n\n            return uploadResult\n        } catch (err) {\n            error.value = err.message\n            throw err\n        }\n    }\n\n    async function sendSOSAlert(location, notes = '') {\n        loading.value = true\n\n        try {\n            const result = await frappeClient.call('tems.api.pwa.driver.send_sos_alert', {\n                location_data: location,\n                notes: notes\n            })\n\n            return result\n        } catch (err) {\n            error.value = err.message\n            throw err\n        } finally {\n            loading.value = false\n        }\n    }\n\n    async function fetchIncidents() {\n        loading.value = true\n\n        try {\n            const data = await frappeClient.call('tems.api.pwa.driver.get_driver_incidents')\n            incidents.value = data || []\n            return data\n        } catch (err) {\n            error.value = err.message\n            throw err\n        } finally {\n            loading.value = false\n        }\n    }\n\n    return {\n        incidents,\n        loading,\n        error,\n        reportIncident,\n        uploadIncidentPhoto,\n        sendSOSAlert,\n        fetchIncidents\n    }\n})\n"],"names":["useIncidentStore","defineStore","incidents","ref","loading","error","reportIncident","incidentData","result","frappeClient","err","uploadIncidentPhoto","file","incidentName","sendSOSAlert","location","notes","fetchIncidents","data"],"mappings":"4FAIY,MAACA,EAAmBC,EAAY,WAAY,IAAM,CAC1D,MAAMC,EAAYC,EAAI,CAAA,CAAE,EAClBC,EAAUD,EAAI,EAAK,EACnBE,EAAQF,EAAI,IAAI,EAEtB,eAAeG,EAAeC,EAAc,CACxCH,EAAQ,MAAQ,GAChBC,EAAM,MAAQ,KAEd,GAAI,CACA,MAAMG,EAAS,MAAMC,EAAa,KAAK,sCAAuC,CAC1E,KAAMF,CACtB,CAAa,EAGD,OAAAL,EAAU,MAAM,QAAQ,CACpB,KAAMM,EAAO,SACb,GAAGD,EACH,OAAQ,OACR,QAAS,IAAI,KAAI,EAAG,YAAW,CAC/C,CAAa,EAEMC,CACX,OAASE,EAAK,CACV,MAAAL,EAAM,MAAQK,EAAI,QACZA,CACV,QAAC,CACGN,EAAQ,MAAQ,EACpB,CACJ,CAEA,eAAeO,EAAoBC,EAAMC,EAAe,KAAM,CAC1D,GAAI,CAOA,OANqB,MAAMJ,EAAa,WACpCG,EACA,GACA,gBAChB,CAGQ,OAASF,EAAK,CACV,MAAAL,EAAM,MAAQK,EAAI,QACZA,CACV,CACJ,CAEA,eAAeI,EAAaC,EAAUC,EAAQ,GAAI,CAC9CZ,EAAQ,MAAQ,GAEhB,GAAI,CAMA,OALe,MAAMK,EAAa,KAAK,qCAAsC,CACzE,cAAeM,EACf,MAAOC,CACvB,CAAa,CAGL,OAASN,EAAK,CACV,MAAAL,EAAM,MAAQK,EAAI,QACZA,CACV,QAAC,CACGN,EAAQ,MAAQ,EACpB,CACJ,CAEA,eAAea,GAAiB,CAC5Bb,EAAQ,MAAQ,GAEhB,GAAI,CACA,MAAMc,EAAO,MAAMT,EAAa,KAAK,0CAA0C,EAC/E,OAAAP,EAAU,MAAQgB,GAAQ,CAAA,EACnBA,CACX,OAASR,EAAK,CACV,MAAAL,EAAM,MAAQK,EAAI,QACZA,CACV,QAAC,CACGN,EAAQ,MAAQ,EACpB,CACJ,CAEA,MAAO,CACH,UAAAF,EACA,QAAAE,EACA,MAAAC,EACA,eAAAC,EACA,oBAAAK,EACA,aAAAG,EACA,eAAAG,CACR,CACA,CAAC"}