import{B as b,r as s,c as h,C as i}from"./index-B9iqHgVa.js";const I=b("vehicle",()=>{const v=s([]),r=s(null),d=s([]),c=s([]),u=s([]),a=s(!1),n=s(null),f=h(()=>v.value.filter(e=>e.status==="Active")),p=h(()=>r.value?{...r.value,lastFuel:c.value[0]||null,pendingMaintenance:u.value.filter(e=>e.status==="Open"||e.status==="In Progress")}:null);async function m(e){a.value=!0,n.value=null;try{const t=await i.call("tems.api.pwa.driver.get_vehicle_info",{vehicle_name:e});return r.value=t.vehicle,c.value=t.last_fuel?[t.last_fuel]:[],u.value=t.pending_maintenance||[],t}catch(t){throw n.value=t.message,t}finally{a.value=!1}}async function g(){a.value=!0,n.value=null;try{const e=await i.call("tems.api.pwa.driver.get_driver_dashboard"),t=[...new Set([...e.journey_plans.map(l=>l.vehicle),...e.operation_plans.map(l=>l.vehicle)].filter(Boolean))];if(t.length>0){const l=await Promise.all(t.map(o=>i.getDoc("Vehicle",o).catch(()=>null)));v.value=l.filter(Boolean)}return v.value}catch(e){throw n.value=e.message,e}finally{a.value=!1}}async function _(e){a.value=!0,n.value=null;try{const t=await i.call("tems.api.pwa.driver.log_fuel",{vehicle:e.vehicle,liters:e.liters,price_per_liter:e.pricePerLiter,odometer:e.odometer,station:e.station,location_data:e.locationData});return c.value.unshift({name:t.fuel_log,vehicle:e.vehicle,liters:e.liters,total_cost:t.total_cost,date:new Date().toISOString(),odometer:e.odometer}),t}catch(t){throw n.value=t.message,t}finally{a.value=!1}}async function y(e){a.value=!0,n.value=null;try{const t=[];if(e.photos&&e.photos.length>0){for(const o of e.photos)if(o.file){const F=await i.uploadFile(o.file,!1,"Home/Vehicle Inspections");t.push({image:F.file_url,caption:o.caption||""})}}return await i.call("tems.api.pwa.driver.submit_spot_check",{vehicle:e.vehicle,location:e.location,notes:e.notes,photos:t})}catch(t){throw n.value=t.message,t}finally{a.value=!1}}async function w(e,t=10){a.value=!0;try{const l=await i.getList("Fuel Log",["name","date","liters","total_cost","odometer","station"],{vehicle:e},t,"date desc");return c.value=l,l}catch(l){throw n.value=l.message,l}finally{a.value=!1}}async function V(e,t=10){a.value=!0;try{const l=await i.getList("Maintenance Work Order",["name","status","planned_date","completion_date","cost","vendor"],{vehicle:e},t,"planned_date desc");return u.value=l,l}catch(l){throw n.value=l.message,l}finally{a.value=!1}}async function L(e,t,l){try{return await i.getList("Asset Utilization Log",["log_date","utilization_hours"],{vehicle:e,log_date:["between",[t,l]]},100,"log_date desc")}catch(o){throw n.value=o.message,o}}function S(e){r.value=e}function C(){r.value=null,c.value=[],u.value=[]}return{vehicles:v,currentVehicle:r,vehicleHistory:d,fuelLogs:c,maintenanceRecords:u,loading:a,error:n,assignedVehicles:f,currentVehicleDetails:p,fetchVehicleInfo:m,fetchMyVehicles:g,logFuel:_,submitSpotCheck:y,fetchFuelHistory:w,fetchMaintenanceHistory:V,getVehicleUtilization:L,setCurrentVehicle:S,clearCurrentVehicle:C}});export{I as u};
//# sourceMappingURL=vehicle-DvZ1-b4P.js.map
