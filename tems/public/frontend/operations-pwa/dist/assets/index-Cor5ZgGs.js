const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-BbY_TLHU.js","assets/vue-vendor-CiCQoITm.js","assets/useAuth-CiFeUeZF.js","assets/utils-2PtTei_Y.js","assets/Layout-DUWgKPKD.js","assets/AppLayout-DRWgHsqB.js","assets/Dashboard-DxJBnFCH.js","assets/FleetTracking-cbiGrJpt.js","assets/VehicleDetails-DEEiu7WQ.js","assets/DispatchManagement-Dn0IWYpI.js","assets/RouteManagement-CTgaPh6L.js","assets/Analytics-FvcDMd5K.js","assets/Settings-Cb77VSgf.js"])))=>i.map(i=>d[i]);
import{d as b,r as w,c as L,s as P,o as k,a as I,b as O,w as A,T as x,e as U,f as _,g as S,F as M,h as N,u as F,n as j,i as y,j as W,t as z,k as V,l as B,m as X,p as H,q as J,v as Q,x as G}from"./vue-vendor-CiCQoITm.js";import{r as K,g as Y}from"./utils-2PtTei_Y.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const Z="modulepreload",ee=function(u){return"/assets/tems/frontend/operations-pwa/dist/"+u},D={},v=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){let c=function(l){return Promise.all(l.map(i=>Promise.resolve(i).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=r?.nonce||r?.getAttribute("nonce");n=c(e.map(l=>{if(l=ee(l),l in D)return;D[l]=!0;const i=l.endsWith(".css"),f=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const p=document.createElement("link");if(p.rel=i?"stylesheet":Z,i||(p.as="script"),p.crossOrigin="",p.href=l,o&&p.setAttribute("nonce",o),document.head.appendChild(p),i)return new Promise((d,g)=>{p.addEventListener("load",d),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return n.then(r=>{for(const o of r||[])o.status==="rejected"&&a(o.reason);return t().catch(a)})};var te=K();const $=Y(te);class ne{constructor(){this.baseURL=window.location.origin,this.isOnline=navigator.onLine,this.retryAttempts=3,this.retryDelay=1e3,this.offlineStore=$.createInstance({name:"tems_offline"}),this.queueStore=$.createInstance({name:"tems_queue"}),window.addEventListener("online",()=>{this.isOnline=!0,this.syncOfflineData()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async call(t,e={},s=!1){const n=`${this.baseURL}/api/method/${t}`,a=`rpc:${t}:${JSON.stringify(e)}`;try{const r=await this.fetchWithRetry(n,{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},credentials:"include",body:JSON.stringify(e)});if(!r.ok){const c=await r.json().catch(()=>({}));throw new Error(c.message||`HTTP error! status: ${r.status}`)}const o=await r.json();return s&&o.message&&await this.offlineStore.setItem(a,{data:o.message,timestamp:Date.now()}),o.message}catch(r){if(!this.isOnline)return this.handleOfflineRequest(a);throw r}}async getDoc(t,e){const s=`${this.baseURL}/api/resource/${t}/${e}`,n=`${t}:${e}`;try{const a=await this.fetchWithRetry(s,{credentials:"include",headers:{"X-Frappe-CSRF-Token":this.getCSRFToken()}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();return await this.offlineStore.setItem(n,{data:r.data,timestamp:Date.now()}),r.data}catch(a){if(!this.isOnline){const r=await this.offlineStore.getItem(n);if(r)return r.data}throw a}}async getList(t,e=["name"],s={},n=20,a="modified desc"){const r=`${this.baseURL}/api/resource/${t}`,o=new URLSearchParams({fields:JSON.stringify(e),filters:JSON.stringify(s),limit_page_length:n,order_by:a}),c=`list:${t}:${JSON.stringify(s)}:${n}`;try{const l=await this.fetchWithRetry(`${r}?${o}`,{credentials:"include",headers:{"X-Frappe-CSRF-Token":this.getCSRFToken()}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const i=await l.json();return await this.offlineStore.setItem(c,{data:i.data,timestamp:Date.now()}),i.data}catch(l){if(!this.isOnline){const i=await this.offlineStore.getItem(c);if(i)return i.data}throw l}}async setDoc(t,e,s){if(!this.isOnline)return this.queueOfflineWrite(t,e,s,"update");const n=`${this.baseURL}/api/resource/${t}/${e}`,a=await this.fetchWithRetry(n,{method:"PUT",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},credentials:"include",body:JSON.stringify(s)});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();return await this.offlineStore.setItem(`${t}:${e}`,{data:r.data,timestamp:Date.now()}),r.data}async createDoc(t,e){if(!this.isOnline)return this.queueOfflineWrite(t,null,e,"create");const s=`${this.baseURL}/api/resource/${t}`,n=await this.fetchWithRetry(s,{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":this.getCSRFToken()},credentials:"include",body:JSON.stringify(e)});if(!n.ok){const a=await n.json().catch(()=>({}));throw new Error(a.message||"Failed to create document")}return await n.json()}async deleteDoc(t,e){if(!this.isOnline)return this.queueOfflineWrite(t,e,{},"delete");const s=`${this.baseURL}/api/resource/${t}/${e}`;if(!(await fetch(s,{method:"DELETE",headers:{"X-Frappe-CSRF-Token":this.getCSRFToken()},credentials:"include"})).ok)throw new Error("Failed to delete document");await this.offlineStore.removeItem(`${t}:${e}`)}async uploadFile(t,e=!1,s="Home",n=null,a=null){const r=new FormData;r.append("file",t),r.append("is_private",e?1:0),r.append("folder",s),n&&r.append("doctype",n),a&&r.append("docname",a);const o=await fetch(`${this.baseURL}/api/method/upload_file`,{method:"POST",headers:{"X-Frappe-CSRF-Token":this.getCSRFToken()},credentials:"include",body:r});if(!o.ok)throw new Error("Upload failed");return(await o.json()).message}async fetchWithRetry(t,e,s=1){try{return await fetch(t,e)}catch(n){if(s<this.retryAttempts&&this.isOnline)return await this.delay(this.retryDelay*s),this.fetchWithRetry(t,e,s+1);throw n}}getCSRFToken(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||document.cookie.split("; ").find(t=>t.startsWith("csrf_token="))?.split("=")[1]||""}async queueOfflineWrite(t,e,s,n="update"){const a=await this.queueStore.getItem("write_queue")||[],r={id:`${Date.now()}_${Math.random()}`,doctype:t,name:e,data:s,action:n,timestamp:Date.now()};return a.push(r),await this.queueStore.setItem("write_queue",a),{queued:!0,offline:!0,queueId:r.id,message:"Saved offline. Will sync when online."}}async syncOfflineData(){const t=await this.queueStore.getItem("write_queue")||[];if(t.length===0)return{synced:0,failed:[]};const e={synced:0,failed:[]};for(const s of t)try{s.action==="create"?await this.createDoc(s.doctype,s.data):s.action==="update"?await this.setDoc(s.doctype,s.name,s.data):s.action==="delete"&&await this.deleteDoc(s.doctype,s.name),e.synced++}catch(n){console.error("Sync failed for item:",s,n),e.failed.push({item:s,error:n.message})}return e.failed.length===0?await this.queueStore.setItem("write_queue",[]):await this.queueStore.setItem("write_queue",e.failed.map(s=>s.item)),e}async getPendingQueueCount(){return(await this.queueStore.getItem("write_queue")||[]).length}async handleOfflineRequest(t){const e=await this.offlineStore.getItem(t);return e?e.data:{offline:!0,error:"No cached data available",message:"You are offline and this data is not cached"}}async clearCache(){await this.offlineStore.clear(),await this.queueStore.clear()}delay(t){return new Promise(e=>setTimeout(e,t))}async isAuthenticated(){try{const t=await fetch(`${this.baseURL}/api/method/frappe.auth.get_logged_user`,{credentials:"include",headers:{"X-Frappe-CSRF-Token":this.getCSRFToken()}});if(!t.ok)return!1;const e=await t.json();return e.message&&e.message!=="Guest"}catch{return!1}}async getCurrentUser(){try{const t=await fetch(`${this.baseURL}/api/method/frappe.auth.get_logged_user`,{credentials:"include",headers:{"X-Frappe-CSRF-Token":this.getCSRFToken()}});if(!t.ok)return null;const e=await t.json();return e.message!=="Guest"?e.message:null}catch{return null}}}const T=new ne,se=b("auth",()=>{const u=w(null),t=w(null),e=w([]),s=w([]),n=w(!1),a=w(null),r=L(()=>!!u.value),o=L(()=>t.value?.employee_name||u.value?.full_name||"User"),c=L(()=>o.value.split(" ").map(m=>m[0]).slice(0,2).join("").toUpperCase());async function l(){n.value=!0,a.value=null;try{const h=await T.getCurrentUser();if(!h||h==="Guest")throw new Error("Not authenticated");const m=await T.getDoc("User",h);if(u.value=m,s.value=m.roles?.map(C=>C.role)||[],m.name)try{const C=await T.getList("Employee",["name","employee_name","designation","image","department","cell_number"],[["user_id","=",m.name]],1);C&&C.length>0&&(t.value=C[0])}catch(C){console.warn("Employee not found for user:",C)}return m}catch(h){throw a.value=h.message,console.error("Failed to fetch user info:",h),h}finally{n.value=!1}}function i(h){return s.value.includes(h)}function f(h){return h.some(m=>s.value.includes(m))}function p(h,m="read"){return!0}async function d(){try{await T.call("logout"),u.value=null,t.value=null,e.value=[],s.value=[],window.location.href="/login"}catch(h){console.error("Logout failed:",h),a.value=h.message}}function g(){u.value=null,t.value=null,e.value=[],s.value=[],a.value=null}return{user:u,employee:t,permissions:e,roles:s,loading:n,error:a,isAuthenticated:r,userName:o,userInitials:c,fetchUserInfo:l,hasRole:i,hasAnyRole:f,hasPermission:p,logout:d,clearAuth:g}}),re=b("offline",()=>{const u=w(navigator.onLine),t=w(!1),e=w(null),s=w(0),n=w([]),a=L(()=>t.value),r=L(()=>s.value>0),o=L(()=>{if(!e.value)return"Never";const d=Date.now()-e.value,g=Math.floor(d/6e4);if(g<1)return"Just now";if(g===1)return"1 minute ago";if(g<60)return`${g} minutes ago`;const h=Math.floor(g/60);if(h===1)return"1 hour ago";if(h<24)return`${h} hours ago`;const m=Math.floor(h/24);return m===1?"1 day ago":`${m} days ago`});function c(){window.addEventListener("online",()=>{u.value=!0,i()}),window.addEventListener("offline",()=>{u.value=!1}),l(),setInterval(()=>{u.value&&!t.value&&i()},300*1e3)}async function l(){try{s.value=await T.getPendingQueueCount()}catch(d){console.error("Failed to update queue count:",d)}}async function i(){if(!(t.value||!u.value)){t.value=!0,n.value=[];try{const d=await T.syncOfflineData();return d.synced>0&&(console.log(`Synced ${d.synced} offline changes`),e.value=Date.now()),d.failed&&d.failed.length>0&&(n.value=d.failed,console.error("Some items failed to sync:",d.failed)),await l(),d}catch(d){console.error("Sync failed:",d),n.value.push({error:d.message})}finally{t.value=!1}}}async function f(){try{await T.clearCache(),s.value=0,n.value=[],e.value=null}catch(d){throw console.error("Failed to clear offline data:",d),d}}async function p(){return i()}return{isOnline:u,syncInProgress:t,lastSyncTime:e,queueCount:s,syncErrors:n,isSyncing:a,hasPendingChanges:r,lastSyncFormatted:o,init:c,updateQueueCount:l,syncOfflineData:i,clearOfflineData:f,retryFailed:p}});function ae(u={}){const{autoInit:t=!1}=u,e=re(),{isOnline:s,syncInProgress:n,lastSyncTime:a,queueCount:r,syncErrors:o,isSyncing:c,hasPendingChanges:l,lastSyncFormatted:i}=P(e);return t&&k(()=>{e.init()}),{isOnline:s,syncInProgress:n,lastSyncTime:a,queueCount:r,syncErrors:o,isSyncing:c,hasPendingChanges:l,lastSyncFormatted:i,init:e.init,sync:e.syncOfflineData,updateQueueCount:e.updateQueueCount,clearCache:e.clearOfflineData,retryFailed:e.retryFailed}}const R=w([]);let oe=0;function ie(){const u=L(()=>R.value);function t(i,f="info",p=3e3){const d=oe++,g={id:d,message:i,type:f,visible:!0,timestamp:Date.now()};return R.value.push(g),p>0&&setTimeout(()=>{e(d)},p),d}function e(i){const f=R.value.findIndex(p=>p.id===i);f>-1&&R.value.splice(f,1)}function s(){R.value=[]}function n(i,f=3e3){return t(i,"success",f)}function a(i,f=5e3){return t(i,"error",f)}function r(i,f=4e3){return t(i,"warning",f)}function o(i,f=3e3){return t(i,"info",f)}function c(i="Loading..."){return t(i,"info",0)}async function l(i,f={}){const{loading:p="Loading...",success:d="Success!",error:g="Error occurred"}=f,h=t(p,"info",0);try{const m=await i;return e(h),n(d),m}catch(m){throw e(h),a(g+(m.message?`: ${m.message}`:"")),m}}return{toasts:u,show:t,dismiss:e,dismissAll:s,success:n,error:a,warning:r,info:o,loading:c,promise:l}}const ce=(u,t)=>{const e=u.__vccOpts||u;for(const[s,n]of t)e[s]=n;return e},le=["onClick"],ue={class:"flex items-start space-x-3 p-4"},de={class:"flex-shrink-0"},fe={key:0,class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},he={key:1,class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},pe={key:2,class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},me={key:3,class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},ge={class:"flex-1 pt-0.5"},ye={class:"text-sm font-medium"},we=["onClick"],ve={key:0,class:"h-1 bg-white bg-opacity-30 rounded-b"},_e={__name:"Toast",setup(u){const{toasts:t,dismiss:e}=ie();function s(r){const o=["rounded-lg shadow-lg max-w-sm w-full transform transition-all duration-300 cursor-pointer","hover:scale-105"],c={success:"bg-green-600 text-white",error:"bg-red-600 text-white",warning:"bg-yellow-500 text-gray-900",info:"bg-blue-600 text-white"};return[...o,c[r.type]||c.info].join(" ")}function n(r){e(r)}function a(r){const c=Date.now()-r.timestamp,l=r.duration||3e3;return Math.max(0,l-c)/l*100}return(r,o)=>(_(),I(U,{to:"body"},[O(x,{name:"toast",tag:"div",class:"fixed top-4 right-4 z-50 space-y-2 pointer-events-none"},{default:A(()=>[(_(!0),S(M,null,N(F(t),c=>(_(),S("div",{key:c.id,class:j([s(c),"pointer-events-auto"]),onClick:l=>n(c.id)},[y("div",ue,[y("div",de,[c.type==="success"?(_(),S("svg",fe,[...o[0]||(o[0]=[y("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):c.type==="error"?(_(),S("svg",he,[...o[1]||(o[1]=[y("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)])])):c.type==="warning"?(_(),S("svg",pe,[...o[2]||(o[2]=[y("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])):(_(),S("svg",me,[...o[3]||(o[3]=[y("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])]))]),y("div",ge,[y("p",ye,z(c.message),1)]),y("button",{type:"button",onClick:V(l=>n(c.id),["stop"]),class:"flex-shrink-0 text-current opacity-70 hover:opacity-100 transition-opacity"},[...o[4]||(o[4]=[y("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[y("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])],8,we)]),c.duration>0?(_(),S("div",ve,[y("div",{class:"h-full bg-white bg-opacity-50 rounded-b transition-all",style:B({width:a(c)+"%"})},null,4)])):W("",!0)],10,le))),128))]),_:1})]))}},Se=ce(_e,[["__scopeId","data-v-e932529d"]]),Ce=[{path:"/login",name:"Login",component:()=>v(()=>import("./Login-BbY_TLHU.js"),__vite__mapDeps([0,1,2,3])),meta:{requiresAuth:!1}},{path:"/",component:()=>v(()=>import("./Layout-DUWgKPKD.js"),__vite__mapDeps([4,5,1,2,3])),meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:()=>v(()=>import("./Dashboard-DxJBnFCH.js"),__vite__mapDeps([6,1,5,2,3]))},{path:"fleet",name:"FleetTracking",component:()=>v(()=>import("./FleetTracking-cbiGrJpt.js"),__vite__mapDeps([7,1,3]))},{path:"fleet/:vehicleId",name:"VehicleDetails",component:()=>v(()=>import("./VehicleDetails-DEEiu7WQ.js"),__vite__mapDeps([8,1,3]))},{path:"dispatch",name:"DispatchManagement",component:()=>v(()=>import("./DispatchManagement-Dn0IWYpI.js"),__vite__mapDeps([9,1,3]))},{path:"routes",name:"RouteManagement",component:()=>v(()=>import("./RouteManagement-CTgaPh6L.js"),__vite__mapDeps([10,1,3]))},{path:"analytics",name:"Analytics",component:()=>v(()=>import("./Analytics-FvcDMd5K.js"),__vite__mapDeps([11,1,3]))},{path:"settings",name:"Settings",component:()=>v(()=>import("./Settings-Cb77VSgf.js"),__vite__mapDeps([12,1,3]))}]}],q=X({history:H("/assets/tems/frontend/operations-pwa/dist/"),routes:Ce});q.beforeEach((u,t,e)=>{const s=se();u.meta.requiresAuth&&!s.isAuthenticated?e({name:"Login",query:{redirect:u.fullPath}}):u.name==="Login"&&s.isAuthenticated?e({name:"Dashboard"}):e()});const Te={id:"app",class:"min-h-screen bg-gray-50"},Le={__name:"App",setup(u){const{startSync:t}=ae();return k(()=>{t()}),(e,s)=>{const n=J("router-view");return _(),S("div",Te,[O(n),O(F(Se))])}}},E=Q(Le),Re=G();E.use(Re);E.use(q);E.mount("#app");export{ce as _,ae as a,se as b,T as f,ie as u};
//# sourceMappingURL=index-Cor5ZgGs.js.map
