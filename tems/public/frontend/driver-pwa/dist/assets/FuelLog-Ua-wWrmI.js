import{r as o,k as P,l as G,c as n,a as e,h as u,m as c,w as O,e as p,g as b,C as A,F as S,q as j,v as x,t as i,d as V,n as J,p as K,o as r}from"./vue-vendor-85nDNI24.js";import{f as h}from"./index-CvUSgFKw.js";import{u as Q}from"./useGeolocation-M200pgtX.js";import{T as W}from"./Toast-DwVcgrDG.js";import{C as X,_ as Y}from"./CameraModal-C0XdpclG.js";import{F as Z}from"./fuel-BZAyrZbw.js";import{M as ee}from"./map-pin-pIZ_tXSm.js";import{c as U}from"./createLucideIcon-TnRFscOj.js";import{f as te}from"./utils-DGK9-2WQ.js";import"./info-D1l5phir.js";import"./triangle-alert-f0HtByGp.js";import"./circle-x-RwOzPd3h.js";import"./x-BTU5YQqX.js";import"./Modal-BTglq67a.js";import"./refresh-cw-BAKKBxtm.js";/**
 * @license lucide-vue-next v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=U("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-vue-next v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=U("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),ae={class:"space-y-6"},oe={class:"card p-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white"},re={class:"flex items-center space-x-3"},ne={class:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm"},ie={class:"card p-6"},ue={class:"space-y-4"},de=["value"],ce={class:"grid grid-cols-2 gap-4"},pe={class:"p-4 bg-primary-50 rounded-lg"},me={class:"flex items-center justify-between"},ve={class:"text-2xl font-bold text-primary-600"},ye=["disabled"],fe={key:0,class:"text-gray-600"},ge={key:1,class:"text-green-600"},be={key:2,class:"text-gray-600"},xe={key:0,class:"mt-2 text-sm text-red-600"},he={class:"flex items-center space-x-3"},ke={key:0,class:"mt-3"},_e=["src"],we=["disabled"],Le={class:"card p-4"},Ve={key:0,class:"text-center py-8 text-gray-500"},Ce={key:1,class:"space-y-3"},Fe={class:"flex items-center justify-between mb-2"},Me={class:"font-medium text-gray-900"},Pe={class:"text-sm text-gray-600"},Se={class:"grid grid-cols-3 gap-2 text-sm"},je={class:"font-medium"},Ue={class:"font-medium"},Te={class:"font-medium"},We={__name:"FuelLog",setup(Re){const{getCurrentPosition:T}=Q(),d=o(!1),m=o(!1),v=o(!1),y=o(""),f=o(!1),g=o(!1),k=o("success"),_=o(""),w=o(""),R=o(null),C=o([]),L=o([]),s=o({vehicle:"",odometer:null,liters:null,pricePerLiter:null,station:"",photo:null,location:null}),q=P(()=>(s.value.liters||0)*(s.value.pricePerLiter||0)),F=P(()=>s.value.vehicle&&s.value.odometer>0&&s.value.liters>0&&s.value.pricePerLiter>0);async function D(){m.value=!0,y.value="";try{const a=await T();s.value.location={lat:a.latitude,lng:a.longitude,accuracy:a.accuracy},v.value=!0}catch(a){y.value="Failed to capture location: "+a.message}finally{m.value=!1}}function N(){f.value=!0}function B(a){s.value.photo=a.dataUrl,f.value=!1}function E(a){const t=a.target.files[0];if(t){const l=new FileReader;l.onload=z=>{s.value.photo=z.target.result},l.readAsDataURL(t)}}async function I(){if(F.value){d.value=!0;try{const a=await h.call("tems.api.pwa.driver.log_fuel",{vehicle:s.value.vehicle,liters:s.value.liters,price_per_liter:s.value.pricePerLiter,odometer:s.value.odometer,station:s.value.station,location_data:s.value.location});k.value="success",_.value="Success",w.value="Fuel log saved successfully",g.value=!0,s.value={vehicle:s.value.vehicle,odometer:null,liters:null,pricePerLiter:null,station:"",photo:null,location:null},v.value=!1,await M()}catch(a){k.value="error",_.value="Error",w.value=a.message||"Failed to save fuel log",g.value=!0}finally{d.value=!1}}}async function M(){try{const a=await h.getList("Fuel Log",["name","vehicle","date","liters","odometer","total_cost"],{},5,"date desc");L.value=a}catch(a){console.error("Failed to fetch recent logs:",a)}}async function H(){try{const a=await h.call("tems.api.pwa.driver.get_driver_dashboard"),t=[...new Set([...(a.journey_plans||[]).map(l=>l.vehicle),...(a.operation_plans||[]).map(l=>l.vehicle)])].filter(Boolean);t.length>0&&(C.value=await h.getList("Vehicle",["name","license_plate","make","model"],{name:["in",t]}))}catch(a){console.error("Failed to fetch vehicles:",a)}}function $(a){return te(new Date(a),"MMM d, yyyy HH:mm")}return G(()=>{H(),M()}),(a,t)=>(r(),n("div",ae,[e("div",oe,[e("div",re,[e("div",ne,[u(c(Z),{class:"w-6 h-6"})]),t[8]||(t[8]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Fuel Log"),e("p",{class:"text-sm text-amber-50"},"Record your fuel purchases")],-1))])]),e("div",ie,[e("form",{onSubmit:O(I,["prevent"])},[e("div",ue,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Vehicle "),e("span",{class:"text-red-500"},"*")],-1)),p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.vehicle=l),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"},[t[9]||(t[9]=e("option",{value:""},"Select Vehicle",-1)),(r(!0),n(S,null,j(C.value,l=>(r(),n("option",{key:l.name,value:l.name},i(l.license_plate||l.name),9,de))),128))],512),[[A,s.value.vehicle]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Odometer Reading (km) "),e("span",{class:"text-red-500"},"*")],-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.odometer=l),type:"number",required:"",step:"0.1",min:"0",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"12345.6"},null,512),[[x,s.value.odometer,void 0,{number:!0}]])]),e("div",ce,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Liters "),e("span",{class:"text-red-500"},"*")],-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.liters=l),type:"number",required:"",step:"0.01",min:"0",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"45.50"},null,512),[[x,s.value.liters,void 0,{number:!0}]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Price/Liter "),e("span",{class:"text-red-500"},"*")],-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.pricePerLiter=l),type:"number",required:"",step:"0.01",min:"0",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"1.50"},null,512),[[x,s.value.pricePerLiter,void 0,{number:!0}]])])]),e("div",pe,[e("div",me,[t[14]||(t[14]=e("span",{class:"text-sm font-medium text-gray-700"},"Total Cost",-1)),e("span",ve,i(q.value.toFixed(2)),1)])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Fuel Station ",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.station=l),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Shell Station - Main St"},null,512),[[x,s.value.station]])]),e("div",null,[e("button",{type:"button",onClick:D,class:"w-full flex items-center justify-center space-x-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors",disabled:m.value},[u(c(ee),{class:J(["w-5 h-5",v.value?"text-green-600":"text-gray-400"])},null,8,["class"]),m.value?(r(),n("span",fe,"Getting location...")):v.value?(r(),n("span",ge,"Location captured")):(r(),n("span",be,"Capture Location"))],8,ye),y.value?(r(),n("p",xe,i(y.value),1)):V("",!0)]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Receipt Photo ",-1)),e("div",he,[e("button",{type:"button",onClick:N,class:"flex-1 flex items-center justify-center space-x-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors"},[u(c(X),{class:"w-5 h-5 text-gray-400"}),t[16]||(t[16]=e("span",{class:"text-gray-600"},"Take Photo",-1))]),e("input",{ref_key:"fileInput",ref:R,type:"file",accept:"image/*",onChange:E,class:"hidden"},null,544),e("button",{type:"button",onClick:t[5]||(t[5]=l=>a.$refs.fileInput.click()),class:"flex-1 flex items-center justify-center space-x-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors"},[u(c(se),{class:"w-5 h-5 text-gray-400"}),t[17]||(t[17]=e("span",{class:"text-gray-600"},"Upload",-1))])]),s.value.photo?(r(),n("div",ke,[e("img",{src:s.value.photo,alt:"Receipt",class:"w-full h-48 object-cover rounded-lg"},null,8,_e)])):V("",!0)]),e("button",{type:"submit",class:"w-full btn-primary py-3",disabled:d.value||!F.value},[d.value?(r(),K(c(le),{key:0,class:"w-5 h-5 mr-2 animate-spin"})):V("",!0),e("span",null,i(d.value?"Saving...":"Save Fuel Log"),1)],8,we)])],32)]),e("div",Le,[t[22]||(t[22]=e("h3",{class:"section-title mb-4"},"Recent Entries",-1)),L.value.length===0?(r(),n("div",Ve," No recent fuel logs ")):(r(),n("div",Ce,[(r(!0),n(S,null,j(L.value,l=>(r(),n("div",{key:l.name,class:"p-3 bg-gray-50 rounded-lg"},[e("div",Fe,[e("span",Me,i(l.vehicle),1),e("span",Pe,i($(l.date)),1)]),e("div",Se,[e("div",null,[t[19]||(t[19]=e("p",{class:"text-gray-500"},"Liters",-1)),e("p",je,i(l.liters),1)]),e("div",null,[t[20]||(t[20]=e("p",{class:"text-gray-500"},"Odometer",-1)),e("p",Ue,i(l.odometer),1)]),e("div",null,[t[21]||(t[21]=e("p",{class:"text-gray-500"},"Cost",-1)),e("p",Te,i(l.total_cost),1)])])]))),128))]))]),u(Y,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=l=>f.value=l),onCapture:B},null,8,["modelValue"]),u(W,{modelValue:g.value,"onUpdate:modelValue":t[7]||(t[7]=l=>g.value=l),type:k.value,title:_.value,message:w.value},null,8,["modelValue","type","title","message"])]))}};export{We as default};
//# sourceMappingURL=FuelLog-Ua-wWrmI.js.map
