import{s as F,r as i,k as u,A as L,l as z,c as p,a as e,h as g,m as C,t as v,g as E,x as H,n as B,F as K,q as R,i as q,o as y,d as V,e as Q,B as G,v as J}from"./vue-vendor-85nDNI24.js";import{f as T}from"./index-CvUSgFKw.js";import{_ as W}from"./LoadingSpinner-BQrI8T8P.js";import{_ as X}from"./EmptyState-Ws_K2wgV.js";import{_ as Y}from"./StatusBadge-q7HUT-w6.js";import{M as Z}from"./Modal-BTglq67a.js";import{T as ee}from"./Toast-DwVcgrDG.js";import{A as te,S as M}from"./scan-L0sEcqeZ.js";import{U as se}from"./users-BMsH5R0H.js";import{f as ae,p as le}from"./utils-DGK9-2WQ.js";import"./createLucideIcon-TnRFscOj.js";import"./circle-x-RwOzPd3h.js";import"./x-BTU5YQqX.js";import"./info-D1l5phir.js";import"./triangle-alert-f0HtByGp.js";const ne=F("passenger",()=>{const S=i(null),x=i([]),n=i(!1),c=i(null),w=u(()=>S.value?.total_seats||0),m=u(()=>x.value.filter(r=>r.status==="Boarded").length),_=u(()=>w.value-m.value);async function f(r){n.value=!0,c.value=null;try{const o=await T.call("tems.api.pwa.driver.get_passenger_manifest",{trip_id:r});return S.value=o.manifest,x.value=o.bookings||[],o}catch(o){throw c.value=o.message,o}finally{n.value=!1}}async function b(r,o){n.value=!0;try{const a=await T.call("tems.api.pwa.driver.scan_passenger_ticket",{ticket_code:r,trip_id:o}),d=x.value.find(k=>k.ticket_code===r);return d&&(d.status="Boarded",d.boarding_time=new Date().toISOString()),a}catch(a){throw c.value=a.message,a}finally{n.value=!1}}async function h(r,o){n.value=!0;try{const a=await T.call("tems.api.pwa.driver.update_boarding_status",{booking_id:r,status:o,timestamp:new Date().toISOString()}),d=x.value.find(k=>k.name===r);return d&&(d.status=o),a}catch(a){throw c.value=a.message,a}finally{n.value=!1}}return{manifest:S,bookings:x,totalSeats:w,occupiedSeats:m,availableSeats:_,loading:n,error:c,fetchPassengerManifest:f,scanTicket:b,updateBoardingStatus:h}}),oe={class:"space-y-6"},re={class:"card p-4"},ie={class:"flex items-center justify-between mb-2"},ue={class:"flex items-center space-x-3"},ce={class:"text-sm text-gray-600"},de={class:"card p-4"},ve={class:"flex items-center justify-between mb-3"},me={class:"text-sm text-gray-600"},fe={class:"w-full bg-gray-200 rounded-full h-3 overflow-hidden"},pe={class:"grid grid-cols-3 gap-3 mt-4"},ge={class:"text-center"},ye={class:"text-2xl font-bold text-green-600"},xe={class:"text-center"},_e={class:"text-2xl font-bold text-amber-600"},be={class:"text-center"},he={class:"text-2xl font-bold text-gray-600"},we={class:"card"},ke={class:"p-4 border-b flex items-center justify-between"},Se={class:"flex items-center space-x-2"},Ce={key:0,class:"p-8"},Be={key:1,class:"p-8"},Te={key:2,class:"divide-y max-h-[500px] overflow-y-auto"},$e={class:"flex items-start justify-between"},Pe={class:"flex items-center space-x-3 flex-1"},Ve={class:"flex-1"},Me={class:"flex items-center space-x-2 mb-1"},Ne={class:"font-semibold text-gray-900"},Ae={class:"text-sm text-gray-600"},Ie={key:0,class:"text-xs text-gray-500 mt-1"},je=["onClick","disabled"],Oe={class:"space-y-4"},Ue={class:"p-4 bg-gray-100 rounded-lg text-center"},De={class:"mt-4"},Fe={class:"flex space-x-2"},Le=["disabled"],at={__name:"PassengerManagement",setup(S){const x=L(),n=ne(),c=u(()=>x.params.id),w=i(!1),m=i(!1),_=i(!1),f=i(!1),b=i("success"),h=i(""),r=i(""),o=i(""),a=i("all"),d=u(()=>n.totalSeats),k=u(()=>n.occupiedSeats),N=u(()=>n.availableSeats),A=u(()=>d.value===0?0:k.value/d.value*100),I=u(()=>n.bookings.filter(l=>l.status==="Boarded").length),j=u(()=>n.bookings.filter(l=>l.status==="Confirmed").length),$=u(()=>a.value==="all"?n.bookings:n.bookings.filter(l=>l.status===a.value));function O(){_.value=!0,o.value=""}async function P(){if(o.value){m.value=!0;try{const l=await n.scanTicket(o.value,c.value);b.value=l.success?"success":"warning",h.value=l.success?"Success":"Already Boarded",r.value=l.message,f.value=!0,_.value=!1,o.value="",await n.fetchPassengerManifest(c.value)}catch(l){b.value="error",h.value="Error",r.value=l.message||"Failed to scan ticket",f.value=!0}finally{m.value=!1}}}async function U(l){m.value=!0;try{await n.updateBoardingStatus(l.name,"Boarded"),b.value="success",h.value="Checked In",r.value=`${l.passenger_name} checked in successfully`,f.value=!0}catch(t){b.value="error",h.value="Error",r.value=t.message||"Failed to check in passenger",f.value=!0}finally{m.value=!1}}function D(l){if(!l)return"";try{return ae(le(l),"HH:mm")}catch{return l}}return z(async()=>{w.value=!0;try{await n.fetchPassengerManifest(c.value)}finally{w.value=!1}}),(l,t)=>(y(),p("div",oe,[e("div",re,[e("div",ie,[e("div",ue,[e("button",{onClick:t[0]||(t[0]=s=>l.$router.back()),class:"btn-secondary p-2"},[g(C(te),{class:"w-5 h-5"})]),e("div",null,[t[8]||(t[8]=e("h2",{class:"text-xl font-bold text-gray-900"},"Passenger Manifest",-1)),e("p",ce,"Trip "+v(c.value),1)])]),e("button",{onClick:O,class:"btn-primary"},[g(C(M),{class:"w-5 h-5 mr-2"}),t[9]||(t[9]=E(" Scan Ticket ",-1))])])]),e("div",de,[e("div",ve,[t[10]||(t[10]=e("h3",{class:"font-semibold text-gray-900"},"Seat Occupancy",-1)),e("span",me,v(k.value)+" / "+v(d.value)+" seats ",1)]),e("div",fe,[e("div",{class:"h-full bg-primary-600 transition-all duration-300",style:H({width:A.value+"%"})},null,4)]),e("div",pe,[e("div",ge,[e("p",ye,v(I.value),1),t[11]||(t[11]=e("p",{class:"text-xs text-gray-600"},"Boarded",-1))]),e("div",xe,[e("p",_e,v(j.value),1),t[12]||(t[12]=e("p",{class:"text-xs text-gray-600"},"Confirmed",-1))]),e("div",be,[e("p",he,v(N.value),1),t[13]||(t[13]=e("p",{class:"text-xs text-gray-600"},"Available",-1))])])]),e("div",we,[e("div",ke,[t[14]||(t[14]=e("h3",{class:"font-semibold text-gray-900"},"Passengers",-1)),e("div",Se,[e("button",{onClick:t[1]||(t[1]=s=>a.value="all"),class:B(["px-3 py-1 rounded-lg text-sm",a.value==="all"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700"])}," All ",2),e("button",{onClick:t[2]||(t[2]=s=>a.value="Boarded"),class:B(["px-3 py-1 rounded-lg text-sm",a.value==="Boarded"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700"])}," Boarded ",2),e("button",{onClick:t[3]||(t[3]=s=>a.value="Confirmed"),class:B(["px-3 py-1 rounded-lg text-sm",a.value==="Confirmed"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700"])}," Pending ",2)])]),w.value?(y(),p("div",Ce,[g(W,{message:"Loading manifest..."})])):$.value.length===0?(y(),p("div",Be,[g(X,{icon:C(se),title:"No passengers",message:a.value==="all"?"No passengers booked for this trip.":`No ${a.value.toLowerCase()} passengers.`},null,8,["icon","message"])])):(y(),p("div",Te,[(y(!0),p(K,null,R($.value,s=>(y(),p("div",{key:s.name,class:"p-4 hover:bg-gray-50"},[e("div",$e,[e("div",Pe,[e("div",{class:B(["w-12 h-12 rounded-full flex items-center justify-center font-bold text-white",s.status==="Boarded"?"bg-green-500":"bg-gray-400"])},v(s.seat_number),3),e("div",Ve,[e("div",Me,[e("p",Ne,v(s.passenger_name),1),g(Y,{status:s.status},null,8,["status"])]),e("p",Ae,"Ticket: "+v(s.ticket_code),1),s.boarding_time?(y(),p("p",Ie," Boarded: "+v(D(s.boarding_time)),1)):V("",!0)])]),s.status!=="Boarded"?(y(),p("button",{key:0,onClick:ze=>U(s),class:"btn-sm btn-primary whitespace-nowrap",disabled:m.value}," Check In ",8,je)):V("",!0)])]))),128))]))]),g(Z,{modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=s=>_.value=s),title:"Scan Ticket",size:"lg"},{default:q(()=>[e("div",Oe,[e("div",Ue,[g(C(M),{class:"w-16 h-16 mx-auto mb-4 text-gray-400"}),t[15]||(t[15]=e("p",{class:"text-gray-600 mb-4"},"Position the QR code within the frame",-1)),e("div",De,[Q(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value=s),type:"text",placeholder:"Or enter ticket code manually",class:"w-full px-4 py-2 border rounded-lg",onKeydown:G(P,["enter"])},null,544),[[J,o.value]])])]),e("div",Fe,[e("button",{onClick:t[5]||(t[5]=s=>_.value=!1),class:"flex-1 btn-secondary"}," Cancel "),e("button",{onClick:P,class:"flex-1 btn-primary",disabled:!o.value}," Scan ",8,Le)])])]),_:1},8,["modelValue"]),g(ee,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=s=>f.value=s),type:b.value,title:h.value,message:r.value},null,8,["modelValue","type","title","message"])]))}};export{at as default};
//# sourceMappingURL=PassengerManagement-uf8_EGJM.js.map
